000100141015   X***X
000200141015   X***X
000300141015   X***X
000400141015   X***X
000500141015   X***X
000600141015     FCARACCP   IF A E           K DISK
000700141015     FCARPLNL   IF A E           K DISK
000800141015     F** SQL USES CARUNIQUE
000900141015     F** SQL USES PLNUNIQUE
001000141015     F** SQL USES CMCTPLAN
001100141015     FGRATEINQ  IF   E           K DISK
001200141016     FT200      O  A F  200        DISK
001300141015    ***
001400141015   X***X
001500141015    ***
001600141015     D KF@TRS          S              3S 0
001700141015     D KF@SUB          S              3S 0
001800141015     D KF@ACC          S              4S 0
001900141015     D KF@PLN          S              4A
002000141015     D KF@UNQ          S             10A   INZ('0000000115')
002100141015    ***
002200141015     D DS@GRT        E DS                  EXTNAME(GRATE)
002300141015     D MAX@EFF         S              8S 0
002400141015     D @GROUP          S                   LIKE(CACID3)
002500141016    ***
002600141016     D Q               C                   CONST('","')
002700141016     D X               S            200A
002800141015    ***
002900141015   X***X
003000141016       X = '"NVA ACCOUNT/PLAN CHECK"';
003100141016       EXCEPT OUTF;
003200141016       X = ',';
003300141016       EXCEPT OUTF;
003400141016       X = '"TRUST","SUB","ACCOUNT","PLAN","GROUP #","ACCOUNT/PLAN"';
003500141016       EXCEPT OUTF;
003600141015    ***
003700141015       EXSR $SQL;
003800141015    ***
003900141015       DOU SQLCOD <> *ZEROS;
004000141015    ***
004100141015       EXEC SQL FETCH NEXT FROM K1 INTO :KF@TRS, :KF@SUB, :KF@ACC, :KF@PLN;
004200141015    ***
004300141015          IF SQLCOD = 0;
004400141015    ***
004500141015             EXSR $ACCT;
004600141015    ***
004700141015             EXSR $PLAN;
004800141015    ***
004900141015          ENDIF;
005000141015    ***
005100141015       ENDDO;
005200141015    ***
005300141015       EXEC SQL CLOSE K1;
005400141015       *INLR = *ON;
005500141015    ***
005600141015   S***S
005700141015    ***
005800141015     C     $ACCT         BEGSR
005900141015    ***
006000141015       CHAIN KL#UTSA CARACCR;
006100141015    ***
006200141015       IF NOT %FOUND(CARACCP);
006300141015    ***
006400141015          CLEAR CARACCR;
006500141015          CAUNIQ = KF@UNQ;
006600141015          CATRST = KF@TRS;
006700141015          CASUB# = KF@SUB;
006800141015          CAACCT = KF@ACC;
006900141015          CASTATUS = 'N';
007000141015          CACID1 = ' ';
007100141015          CATXT1 = 'EXPORT FILE NAME';
007200141015          CACID2 = ' ';
007300141015          CATXT2 = 'CONTROL ID';
007400141024          CACID3 = 'N/A';
007500141024          CATXT3 = 'N/A';
007600141015          CACID4 = 'N/A';
007700141015          CATXT4 = 'N/A';
007800141015          CACID5 = 'N/A';
007900141015          CATXT5 = 'N/A';
008000141015          CACID6 = 'N/A';
008100141015          CATXT6 = 'N/A';
008200141015          CACID7 = 'N/A';
008300141015          CATXT7 = 'N/A';
008400141015          CACID8 = 'N/A';
008500141015          CATXT8 = 'N/A';
008600141015          CACID9 = 'N/A';
008700141015          CATXT9 = 'N/A';
008800141015          CACIDA = 'N/A';
008900141015          CATXTA = 'N/A';
009000141015          WRITE(E) CARACCR;
009100141016    ***
009200141016          X = '"' + %EDITC(KF@TRS:'X') + Q + %EDITC(KF@SUB:'X') + Q +
009300141016               %EDITC(KF@ACC:'X') + '",,"' + %TRIM(@GROUP) +
009400141016               '",ACCOUNT';
009500141016          EXCEPT OUTF;
009600141015    ***
009700141015       ENDIF;
009800141015    ***
009900141015     C                   ENDSR
010000141015    ***
010100141015   S***S
010200141015    ***
010300141015     C     $GROUP        BEGSR
010400141015    ***
010500141015       CLEAR DS@GRT;
010600141015       @GROUP = *BLANKS;
010700141015       MAX@EFF = 0;
010800141015    ***
010900141015       CHAIN KL#TSP GRATER;
011000141015       IF NOT %FOUND(GRATEINQ);
011100141015          LEAVESR;
011200141015       ENDIF;
011300141015    ***
011400141015       SETLL KL#TSP GRATER;
011500141015       DOU %EOF(GRATEINQ);
011600141015          READE KL#TSP GRATER;
011700141015          IF NOT %EOF(GRATEINQ) AND FRMDAT <> TODAT;
011800141015             IF FRMDAT > MAX@EFF;
011900141015                MAX@EFF = FRMDAT;
012000141015                @GROUP = GROUP#;
012100141015             ENDIF;
012200141015          ENDIF;
012300141015       ENDDO;
012400141015    ***
012500141015     C                   ENDSR
012600141015    ***
012700141015   S***S
012800141015    ***
012900141015     C     $PLAN         BEGSR
013000141015    ***
013100141024       EXSR $GROUP;
013200141024    ***
013300141015       CHAIN KL#UTSPA CARPLNR;
013400141015    ***
013500141015       IF NOT %FOUND(CARPLNL);
013600141015          CLEAR CARPLNR;
013700141015          CPUNIQ = KF@UNQ;
013800141015          CPTRST = KF@TRS;
013900141015          CPSUB# = KF@SUB;
014000141015          CPACCT = KF@ACC;
014100141015          CPPLAN = KF@PLN;
014200141015          CPCCTR = *BLANKS;
014300141024          CPCID1 = %TRIM(@GROUP);
014400141024          CPTXT1 = 'GROUP NUMBER';
014500141015          CPCID2 = 'N/A';
014600141015          CPTXT2 = 'N/A';
014700141015          CPCID3 = 'N/A';
014800141015          CPTXT3 = 'N/A';
014900141015          CPCID4 = 'N/A';
015000141015          CPTXT4 = 'N/A';
015100141015          CPCID5 = 'N/A';
015200141015          CPTXT5 = 'N/A';
015300141015          CPCID6 = 'N/A';
015400141015          CPTXT6 = 'N/A';
015500141015          CPCID7 = 'N/A';
015600141015          CPTXT7 = 'N/A';
015700141015          CPCID8 = 'N/A';
015800141015          CPTXT8 = 'N/A';
015900141015          CPCID9 = 'N/A';
016000141015          CPTXT9 = 'N/A';
016100141015          CPCIDA = 'N/A';
016200141015          CPTXTA = 'N/A';
016300141015          WRITE(E) CARPLNR;
016400141016          X = '"' + %EDITC(KF@TRS:'X') + Q + %EDITC(KF@SUB:'X') + Q +
016500141016               %EDITC(KF@ACC:'X') + Q + KF@PLN + Q + %TRIM(@GROUP) +
016600141016               '",PLAN';
016700141016          EXCEPT OUTF;
016800141027       ELSE;
016900141027          IF %TRIM(CPCID1) <> %TRIM(@GROUP);
017000141027          X = '"' + %EDITC(KF@TRS:'X') + Q + %EDITC(KF@SUB:'X') + Q +
017100141027               %EDITC(KF@ACC:'X') + Q + KF@PLN + Q + %TRIM(@GROUP) +
017200141027               '",THIS GROUP NUMBER IS DIFFERENT';
017300141027          EXCEPT OUTF;
017400141027          ENDIF;
017500141016    ***
017600141015       ENDIF;
017700141015    ***
017800141015     C                   ENDSR
017900141015    ***
018000141015   S***S
018100141015    ***
018200141015     C     *INZSR        BEGSR
018300141015    ***
018400141015     C     KL#UTSPA      KLIST
018500141015     C                   KFLD                    KF@UNQ
018600141015     C                   KFLD                    KF@TRS
018700141015     C                   KFLD                    KF@SUB
018800141015     C                   KFLD                    KF@PLN
018900141015     C                   KFLD                    KF@ACC
019000141015    ***
019100141015     C     KL#TSP        KLIST
019200141015     C                   KFLD                    KF@TRS
019300141015     C                   KFLD                    KF@SUB
019400141015     C                   KFLD                    KF@PLN
019500141015    ***
019600141015     C     KL#UTSA       KLIST
019700141015     C                   KFLD                    KF@UNQ
019800141015     C                   KFLD                    KF@TRS
019900141015     C                   KFLD                    KF@SUB
020000141015     C                   KFLD                    KF@ACC
020100141015    ***
020200141015     C                   ENDSR
020300141015    ***
020400141015   S***S
020500141015    ***
020600141015     C     $SQL          BEGSR
020700141015    ***
020800141015       EXEC SQL DECLARE K1 SCROLL CURSOR FOR
020900141015          SELECT DISTINCT PLTRST, PLSUB#, CMACCT, PLPLAN
021000141015             FROM PLNUNIQUE, CARUNIQUE, CMCTPLAN
021100141015             WHERE PLTRST = CMTRST AND PLSUB# = CSUBDV AND PLPLAN = CMPLAN
021200141015                AND CARRCD = PCARR AND CGRPCD = 'NV'
021300141015             GROUP BY PLTRST, PLSUB#, CMACCT, PLPLAN
021400141015             ORDER BY PLTRST, PLSUB#, CMACCT, PLPLAN;
021500141015    ***
021600141015       EXEC SQL OPEN K1;
021700141015    ***
021800141015     C                   ENDSR
021900141015    ***
022000141015   S***S
022100141016     OT200      EADD         OUTF
022200141016     O                       X              B   200
