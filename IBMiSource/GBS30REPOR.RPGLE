000100190411
000200190411       Ctl-opt option(*noDebugIo)   DftActGrp(*no) bnddir('GBSBIND');
000300190411
000400190411      *-------------------------------------------------------------------------
000500190411      *
000600221027      *  Description: Update repository with TSA/Receive date
000700221027      *  Programmer.: Jon Allen
000800221027      *  Date.......: 10.27.2022
000900190411      *
001000190411      *-------------------------------------------------------------------------
001100211209      * Modifications
001200221018      *
001300211209      *
001400211209      *
001500211209      *-------------------------------------------------------------------------
001600190411
001700190411      *-------------------------------------------------------------------------
001800190411      *
001900190411      * Declare Files
002000190411      *
002100190411      *-------------------------------------------------------------------------
002200190411
002300221031       Dcl-f gbs3mbrpp keyed usage( *input : *update );
002400221031       Dcl-f gbs3mcrpp keyed usage( *input : *update );
002500221031       Dcl-f gbs3dprpp keyed usage( *input : *update );
002600221031       Dcl-f gbs3dcrpp keyed usage( *input : *update );
002700190411
002800190411
002900190411      *-------------------------------------------------------------------------
003000190411      *
003100190411      * Global Variables
003200190411      *
003300190411      *-------------------------------------------------------------------------
003400190411
003500190411       dcl-ds pgmd
003600190411         ExtName('IOPGMD') PSDS;
003700190411         @pgmq *proc;
003800190411       end-ds;
003900190411
004000221027       dcl-s wwtrst Zoned(3);
004100221027       dcl-s wwsub# Zoned(3);
004200221027       dcl-s wwacct Zoned(4);
004300221027       dcl-s wdate Zoned(8);
004400190411
004500190411      *-------------------------------------------------------------------------
004600190411      *
004700190411      * Procedures
004800190411      *
004900190411      *-------------------------------------------------------------------------
005000190411      *
005100190411      * *Entry Procedure
005200190411      *
005300190411      *-------------------------------------------------------------------------
005400190411       Dcl-pr Main ExtPgm;
005500221031         *N  Char(10);
005600190411       End-Pr;
005700190411
005800190411       dcl-pi Main;
005900221031         pKey Char(10);
006000190411       End-Pi;
006100190411
006200190411
006300190411      *-------------------------------------------------------------------------
006400190411      *
006500190411      * Mainline Program
006600190411      *
006700190411      *-------------------------------------------------------------------------
006800190411
006900221027       wwTrst = %Dec( %Subst(pKey:1:3) : 3 : 0 );
007000221027       wwSub# = %Dec( %Subst(pKey:4:3) : 3 : 0 );
007100221027       wwAcct = %Dec( %Subst(pKey:7:4) : 4 : 0 );
007200190411
007300221031      * Member file
007400221031
007500221031         Setll *loval GBS3MBRPP;
007600221031         dou %Eof(GBS3MBRPP);
007700221031           read GBS3MBRPP;
007800221027
007900221031           if %Eof(GBS3MBRPP);
008000221027             leave;
008100221027           endif;
008200221027
008300221031           if L1_RECDATE <> 0;
008400221027             leave;
008500221027           endif;
008600221027
008700221031           L1TSA = pkey;
008800221031           L1_TRST = wwTrst;
008900221031           L1_SUB# = wwSub#;
009000221031           L1_ACCT = wwAcct;
009100221031           L1_RECDATE = %Dec(%Date);
009200221027
009300221031         update  R_GBS3MBRP;
009400190411
009500221027         enddo;
009600221031
009700221031      * Member coverage file
009800221031
009900221031         Setll *loval GBS3MCRPP;
010000221031         dou %Eof(GBS3MCRPP);
010100221031           read GBS3MCRPP;
010200221031
010300221031           if %Eof(GBS3MCRPP);
010400221031             leave;
010500221031           endif;
010600221031
010700221031           if L2_RECDATE <> 0;
010800221031             leave;
010900221031           endif;
011000221031
011100221031           L2TSA = pkey;
011200221031           L2_TRST = wwTrst;
011300221031           L2_SUB# = wwSub#;
011400221031           L2_ACCT = wwAcct;
011500221031           L2_RECDATE = %Dec(%Date);
011600221031
011700221031         update  R_GBS3MCRP;
011800221031
011900221031         enddo;
012000221031
012100221031      * Dependent file
012200221031
012300221031         Setll *loval GBS3DPRPP;
012400221031         dou %Eof(GBS3DPRPP);
012500221031           read GBS3DPRPP;
012600221031
012700221031           if %Eof(GBS3DPRPP);
012800221031             leave;
012900221031           endif;
013000221031
013100221031           if L3_RECDATE <> 0;
013200221031             leave;
013300221031           endif;
013400221031
013500221031           L3TSA = pkey;
013600221031           L3_TRST = wwTrst;
013700221031           L3_SUB# = wwSub#;
013800221031           L3_ACCT = wwAcct;
013900221031           L3_RECDATE = %Dec(%Date);
014000221031
014100221031         update  R_GBS30DEP;
014200221031
014300221031         enddo;
014400221031
014500221031      * Dependent Coverge file
014600221031
014700221031         Setll *loval GBS3DCRPP;
014800221031         dou %Eof(GBS3DCRPP);
014900221031           read GBS3DCRPP;
015000221031
015100221031           if %Eof(GBS3DCRPP);
015200221031             leave;
015300221031           endif;
015400221031
015500221031           if L4_RECDATE <> 0;
015600221031             leave;
015700221031           endif;
015800221031
015900221031           L4TSA = pkey;
016000221031           L4_TRST = wwTrst;
016100221031           L4_SUB# = wwSub#;
016200221031           L4_ACCT = wwAcct;
016300221031           L4_RECDATE = %Dec(%Date);
016400221031
016500221031         update  RGBS30DCOV;
016600221031
016700221031         enddo;
016800221027
016900190411       *inlr = *on;
017000190411
017100190411
