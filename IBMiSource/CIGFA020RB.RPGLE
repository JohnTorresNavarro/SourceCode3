000100180817      *===========================================================================
000200180817     H option(*noDebugIo)
000300180817      *===========================================================================
000400190509      * CIGFA020R - Cigna FI - Facets Generate extract errors
000500180817      *================================================================================
000600180817      * Date        Int   Description
000700180817      * ----------  ---   -------------------------------------------------------------
000800180817      * 03/14/2018  jt    Original creation
000900190509      * 05/09/2019  jt    Adde more files for better selection
000901210714      * 07/15/2021  jt    Added FSA error check
001000180817      *===========================================================================
001100180817
001200180817     fcignafa   if   e           k disk    rename(cignar:cignaFile)
001300180817
001400180817     fcignafaer o    e             disk    rename(cignaer:errorFile)
001500180817
001600180817     fmember    if   e           k disk    rename(membr:memberFile)
001700180817     f                                     extfile('F.MEMBER')
001800180817
001900190509     faccmst    if   e           k disk    rename(accmsr:actFile)
002000190509     f                                     prefix('T')
002100190509     f                                     extfile('F.ACCMST')
002200190509
002300190509     faacode    if   e           k disk    rename(aacodr:aaFile)
002400190509
002500190509
002600190509     d cigfa020rb      pi
002700190509     d  trust                         3
002800190509     d  sub#                          3
002900190509     d  acct                          4
003000190509     d  ssn                           9
003100190509     d  dssn                          9
003200190509     d  plan                          4
003300190509
003400180817      //==================================================================
003500180817      // mainline
003600180817      //===================================================================
003700180817
003800180817       exsr init;
003900180817       exsr main;
004000180817       exsr exit;
004100180817
004200180817      //===================================================================
004300180817      // main
004400180817      //===================================================================
004500180817
004600180817       begsr main;
004700180817
004800180817        setll *loval cignaFile;
004900180817        read cignaFile;
005000180817        dow not %eof;
005100180817
005200180817         if macct# > ' ';
005300180817
005400180817          if mplanid = ' ';
005500180817           ctext = 'Plan ID/Benefit Opt missing';
005600180817           exsr writeError;
005700180817          endif;
005800180817
005900180817          if mbranchcd = ' ';
006000180817           ctext = 'Class ID/Branch Code missing';
006100180817           exsr writeError;
006200180817          endif;
006300180817
006400180817          if mboptcode = ' ';
006500180817           ctext = 'Subgroup/Parent Branch Code missing';
006600180817           exsr writeError;
006700180817          endif;
006800180817
006900180817         endif;
007000180817
007100180817         if dacct# > ' ';
007200180817
007300180817          if dplanid = ' ';
007400180817           ctext = 'Plan ID/Benefit Opt missing';
007500180817           exsr writeError;
007600180817          endif;
007700180817
007800180817          if dbranchcd = ' ';
007900180817           ctext = 'Class ID/Branch Code missing';
008000180817           exsr writeError;
008100180817          endif;
008200180817
008300180817          if dboptcode = ' ';
008400180817           ctext = 'Subgroup/Parent Branch Code missing';
008500180817           exsr writeError;
008600180817          endif;
008700180817
008800180817         endif;
008900180817
009000180817         if vacct# > ' ';
009100180817
009200180817          if vplanid = ' ';
009300180817           ctext = 'Plan ID/Benefit Opt missing';
009400180817           exsr writeError;
009500180817          endif;
009600180817
009700180817          if vbranchcd = ' ';
009800180817           ctext = 'Class ID/Branch Code missing';
009900180817           exsr writeError;
010000180817          endif;
010100180817
010200180817          if vboptcode = ' ';
010300180817           ctext = 'Subgroup/Parent Branch Code missing';
010400180817           exsr writeError;
010500180817          endif;
010600180817
010700180817         endif;
010800180817
010801210714         if facct# > ' ';
010802210714
010803210714          if fplanid = ' ';
010804210714           ctext = 'Plan ID/Benefit Opt missing';
010805210714           exsr writeError;
010806210714          endif;
010807210714
010808210714          if fbranchcd = ' ';
010809210714           ctext = 'Class ID/Branch Code missing';
010810210714           exsr writeError;
010811210714          endif;
010812210714
010813210714          if fboptcode = ' ';
010814210714           ctext = 'Subgroup/Parent Branch Code missing';
010815210714           exsr writeError;
010816210714          endif;
010817210714
010818210714         endif;
010819210714
010900180817        read cignaFile;
011000180817        enddo;
011100180817
011200180817       endsr;
011300180817
011400180817      //===================================================================
011500180817      // Write Error
011600180817      //===================================================================
011700180817
011800180817       begsr writeError;
011900180817
012000180817        chain (%dec(memid:9:0)) memberFile;
012100180817        if %found;
012200180817         mbrid = memid;
012300180817          ctrust = %char(mbtrst);
012400180817           csub# = %char(mbsub#);
012500190509            cacct = %char(mbacct);
012600190509             mbrst = state;
012700190509
012800190509             chain (mbtrst : mbsub# : mbacct) actFile;
012900190509             if %found;
013000190509
013100190509              chain (taacode) aaFile;
013200190509              if %found;
013300190509               acctaa = %trim(afnam) + ' ' + %trim(alnam);
013400190509              endif;
013500190509
013600190509             endif;
013700190509
013800180817         write errorFile;
013900180817        endif;
014000180817
014100180817       endsr;
014200180817
014300180817      //===================================================================
014400180817      // exit
014500180817      //===================================================================
014600180817
014700180817       begsr exit;
014800180817
014900180817        *inlr = '1';
015000180817        return;
015100180817
015200180817       endsr;
015300180817
015400180817      //===================================================================
015500180817      // init
015600180817      //===================================================================
015700180817
015800180817       begsr init;
015900180817
016000180817
016100180817       endsr;
016200180817
016300180817      //===================================================================
