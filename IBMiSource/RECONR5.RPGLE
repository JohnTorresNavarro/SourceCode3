000100160513      *===========================================================================
000200160512     H option(*noDebugIo)
000300160513      *===========================================================================
000400020523      *
000500160513      *             GROUP BENIFIT SERVICES SOFTWARE
000600160513      *
000700160513      *  Written by:   J. Torres
000800160513      *  Date Written: 05/12/16
000900160524      *  Description:  Generate XLS files for EyeMed
001000160524      *                (Old groups are hardcoded because they will not change,
001100160524      *                 all other groups moving forward go under new groups).
001200160513      *
001300160513      *===========================================================================
001400160520
001500170103     Freconevl1 if   e           k disk    rename(reconevr:everFile)
001600161222
001700170203     Frecon4    uf a e           k disk    rename(reconr:reconFile)
001800160523
001900170206     Fdcova     if   e           k disk    rename(dcovr:depcovFile)
002000150820
002100170103     Fdepndc    if   e           k disk    rename(depenr:depmemFile)
002200161222
002300161222     Fmemalt    if   e           k disk    rename(memaltr:altFile)
002400161222
002500170418     Fgrate     if   e           k disk    rename(grater:groupFile)
002600170418
002700170418     Faccmst    if   e           k disk    rename(accmsr:acctFile)
002800170418
002900170418     Fmember    if   e           k disk    rename(membr:memberFile)
003000170418
003100161228      //==================================================================
003200161228
003300170418     D fmtDate         s               d   datfmt(*usa)
003400170418     D group           s             15
003500170418     D $pos            S              2  0
003600170418     D maaltid9        s              9
003700170418     D s               s              3
003800161228
003900160511      //==================================================================
004000160511      // mainline
004100160511      //===================================================================
004200150820
004300160511       exsr init;
004400160511       exsr main;
004500160511       exsr exit;
004600160511
004700160511      //===================================================================
004800160511      // main
004900160511      //===================================================================
005000160511
005100160511       begsr main;
005200160511
005300170206        setll *loval depcovFile;
005400170206        read depcovFile;
005500161222
005600161222        dow not %eof;
005700170103
005800170418        s = %subst(%editc(ssno:'X'):1:3);
005900170418        if s <> '888';
006000161222
006100160524        // Create file with new groups...
006200170103        chain (dvtrst : dvsub# : dvplan) everFile;
006300161222        if %found;
006400161222         exsr moveFields;
006500161222         exsr writeFile;
006600161222        endif;
006700161228
006800170418        endif;
006900170418
007000170206        read depcovFile;
007100161222        enddo;
007200161222
007300170418       exsr dateFix;
007400170418
007500160511       endsr;
007600160520
007700161222      //===================================================================
007800161222      // move fileds
007900161222      //===================================================================
008000161222
008100170103       begsr moveFields;
008200170206
008300170418       orgdate = %char(ccandt);
008400170206       if orgdate = '0';
008500170206        orgdate = ' ';
008600170206       endif;
008700161222
008800170103       chain (ssno : dseq#) depmemFile;
008900161222       if %found;
009000170418        ssn# = %editc(ssno:'X');
009100170103         lname = dlname;
009200170103        fname = dfname;
009300161222       endif;
009400161222
009500170103       chain (dssno : 'EV') altFile;
009600161222       if %found;
009700170418
009800170418        $pos = %scan('EV':maaltid:1);
009900170418        if $pos = 1;
010000170418         maaltid9 = maaltid;
010100170418         altid = maaltid9;
010200170418        else;
010300170418         altid = maaltid;
010400170418        endif;
010500170418
010600161222       endif;
010700161222
010800170418       chain ssno memberFile;
010900170418       if %found;
011000170418
011100170418        chain (mbtrst : mbsub# : mbacct) acctFile;
011200170418        if %found;
011300170418         cname = acnam1;
011400170418        endif;
011500170418
011600170418       endif;
011700170418
011800161222       endsr;
011900161222
012000161222      //===================================================================
012100161222      // write file;
012200161222      //===================================================================
012300161222
012400161222       begsr writeFile;
012500161222
012600170418       chain (%editc(ssno:'X') : dseq#) reconFile;
012700170103       if not %found;
012800170103        seq# = dseq#;
012900170418         exsr getGroup;
013000170103        write reconFile;
013100170103       endif;
013200161227
013300170418       if %found (recon4);
013400170206
013500170206        if orgdate = ' ';
013600170206         orgdate = ' ';
013700170418          exsr getGroup;
013800170418          update reconFile;
013900170206         leavesr;
014000170206        endif;
014100170206
014200170206        if orgdate > %char(ccandt);
014300170206         orgdate = %char(ccandt);
014400170206         if orgdate = '0';
014500170206          orgdate = ' ';
014600170418           endif;
014700170418          exsr getGroup;
014800170206         update reconFile;
014900170206        endif;
015000170206
015100170206        if orgdate <> ' ';
015200170206         if %char(ccandt) > orgdate;
015300170206          orgdate = %char(ccandt);
015400170206          if orgdate = '0';
015500170206           orgdate = ' ';
015600170206          endif;
015700170206          update reconFile;
015800170206         endif;
015900170206        endif;
016000170206
016100170206       endif;
016200161222
016300161222       endsr;
016400161222
016500170418      //===================================================================
016600170418      // Get group #
016700170418      //===================================================================
016800170418
016900170418       begsr getGroup;
017000170418
017100170418       group = ' ';
017200170418
017300170418       setll (dvtrst : dvsub# : dvplan : 00) groupFile;
017400170418       reade (dvtrst : dvsub# : dvplan : 00) groupFile;
017500170418
017600170418       dow not %eof;
017700170418       if (denrdt >= frmdat) and (denrdt <= todat);
017800170418        group = group#;
017900170418        leavesr;
018000170418       endif;
018100170418
018200170418       reade (dvtrst : dvsub# : dvplan : 00) groupFile;
018300170418       enddo;
018400170418
018500170418       endsr;
018600170418
018700170418      //===================================================================
018800170418      // fix date
018900170418      //===================================================================
019000170418
019100170418       begsr dateFix;
019200170418
019300170418       setll *loval reconFile;
019400170418       read reconFile;
019500170418
019600170418       dow not %eof;
019700170418
019800170418       if orgdate > ' ';
019900170418        fmtDate = %date(%dec(%char(orgdate):10:0):*iso);
020000170418         orgdate = %char(fmtDate);
020100170418        update reconFile;
020200170418       endif;
020300170418
020400170418       read reconFile;
020500170418       enddo;
020600170418
020700170418       endsr;
020800170418
020900160511      //===================================================================
021000160511      // exit
021100160511      //===================================================================
021200160511
021300160511       begsr exit;
021400160511
021500160511        *inlr = '1';
021600160511        return;
021700160511
021800160511       endsr;
021900160511
022000160511      //===================================================================
022100160511      // init
022200160511      //===================================================================
022300160511
022400160511       begsr init;
022500160520
022600160511       endsr;
022700010412
022800160511       //==============================================================
