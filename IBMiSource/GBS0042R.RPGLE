000100171229
000200180912       Ctl-opt option(*noDebugIo)  bnddir('GBSBIND' )
000300180912          DftActGrp(*no)      ;
000400171229
000500171229      *-------------------------------------------------------------------------
000600171229      *
000700180912      *  Description: Prompt Screen for the OLE Transaction Report
000800180912      *  Programmer.: Brian Rees
000900180912      *  Date.......: 09/12/2018
001000171229      *
001100171229      *-------------------------------------------------------------------------
001200180227
001300180227      *-------------------------------------------------------------------------
001400180227      *
001500180912      *  Change Log:
001600180227      *
001700180227      *-------------------------------------------------------------------------
001800171229
001900171229      *-------------------------------------------------------------------------
002000171229      *
002100171229      * Declare Files
002200171229      *
002300171229      *-------------------------------------------------------------------------
002400180912       Dcl-f GBS0042D WorkStn
002500180912          Handler('PROFOUNDUI(HANDLER)');
002600180912
002700180912       Dcl-f AccMst keyed ExtDesc('F.ACCMST') ExtFile(*extdesc);
002800171229
002900171229
003000171229      *-------------------------------------------------------------------------
003100171229      *
003200171229      * Global Variables
003300171229      *
003400171229      *-------------------------------------------------------------------------
003500171229
003600180511       dcl-ds pgmd
003700180511          ExtName('IOPGMD') PSDS;
003800180511          @pgmq *proc;
003900180511       end-ds;
004000180511
004100180227
004200171229       dcl-c q  '''';
004300171229       dcl-c digits  '0123456789';
004400180613
004500180912       dcl-s wActNbr like( s1ActNbr );
004600180912       dcl-s wTrst    Zoned(3);
004700180912       dcl-s wSub#    Zoned(3);
004800180912       dcl-s wAcct    Zoned(4);
004900180912
005000180912       dcl-s x Char(8);
005100170605
005200180912
005300180912      *-------------------------------------------------------------------------
005400180912      *
005500180912      * *Entry Procedure
005600180912      *
005700180912      *-------------------------------------------------------------------------
005800180912       Dcl-pr Main ExtPgm;
005900180912          *N  Char(3);
006000180912          *N  Char(3);
006100180912          *N  Char(4);
006200180912          *N  Char(8);
006300180912          *N  Char(8);
006400180913          *N  Char(1);
006500180912
006600180912       End-Pr;
006700180912
006800180912       dcl-pi Main;
006900180912          pTrst  Char(3);
007000180912          pSub#  Char(3);
007100180912          pAcct  Char(4);
007200180912          pFromDt  Char(8);
007300180912          PToDate  Char(8);
007400180913          pContinue Char(1);
007500180912       End-Pi;
007600180912
007700180912
007800161111      *--------------------------------------------
007900171229      *
008000171229      * Procedures
008100171229      *
008200161111      *--------------------------------------------
008300180222
008400180222       /include GBSPGM/QMODSRC,#GettokPR
008500180222       /include GBSPGM/QMODSRC,#zFillpr
008600180604
008700180912
008800180404      *-------------------------------------------------------------------------
008900180404      *
009000180404      * Mainline Program
009100180404      *
009200180404      *-------------------------------------------------------------------------
009300171106
009400180912       Dou btnExit = *on;
009500180912
009600180913
009700180912          exfmt screen1;
009800180912
009900180912          errAccount = *off;
010000180912
010100180912          // Check to see if the Account Number has changed.
010200180912          if ActChgd = *on;
010300180912
010400180912             // For the people who press "Field+"
010500180912             s1ActNbr = %ScanRpl( '+' : '-' : s1ActNbr );
010600180912
010700180912
010800180912             split();
010900180912             wActNbr = s1ActNbr;
011000180912
011100180912             s1ActNbr = %ScanRpl( '-' : '' : s1ActNbr );
011200180912             s1ActNbr = %ScanRpl( ' ' : '' : s1ActNbr );
011300180912
011400170605
011500180912             if %check( digits : %Trim( s1ActNbr )) = 0  and
011600180912                %Len(%Trim( s1ActNbr )) = 10;
011700180912                wTrst = %Dec( %Subst( s1ActNbr : 1 : 3) : 3 : 0 );
011800180912                wSub# = %Dec( %Subst( s1ActNbr : 4 : 3) : 3 : 0 );
011900180912                wAcct = %Dec( %Subst( s1ActNbr : 7 : 4) : 4 : 0 );
012000180912
012100180912                chain ( wTrst : wSub# : wAcct ) AccMst;
012200180912                if not %Found( AccMst );
012300180912                   ErrAccount = *on;
012400180912                   s1ActNBr = wActNbr;
012500180912                   iter;
012600171130                endif;
012700171130
012800171130             else;
012900171130
013000171130                errAccount = *on;
013100180912
013200171130             endif;
013300180912          endif;
013400180912
013500180912
013600180913          if btnExit = *on;
013700180913             pContinue = 'N';
013800180913             leave;
013900180913          EndIf;
014000180913
014100180913
014200180912          if btnAccept = *on;
014300180913             pTrst = %Editc(wTrst : 'X' );
014400180913             pSub# = %Editc(wSub# : 'X' );
014500180913             pAcct = %Editc(wAcct : 'X' );
014600180913
014700180913             pFromDt = %char( %date(s1FromDt : *usa) : *iso0);
014800180913             pToDate = %char( %date(s1ToDate : *usa) : *iso0);
014900180913
015000180913             pContinue = 'Y';
015100180913
015200180913             leave;
015300180912
015400180912          EndIf;
015500180912
015600170525       enddo;
015700170529
015800180912
015900180912
016000180912
016100170525       *inlr = *on;
016200170525
016300171106
016400180222
016500180222
016600180222      *-------------------------------------------------------------------------
016700180222      * Split out the account number
016800180222      *-------------------------------------------------------------------------
016900180222       Dcl-Proc Split;
017000180222
017100180417          dcl-s x int(10);
017200180417          dcl-s tokens varchar(100) dim(50);
017300180417          dcl-s Trst Char(3);
017400180417          dcl-s Sub  Char(3);
017500180417          dcl-s Acct Char(4);
017600180222
017700180417          tokens(*) = #Gettok( s1ActNbr : '-' : x );
017800180222
017900180222
018000180417          // we should have 3 array elements filled  in.
018100180417          // the next blank space should be #4.
018200180417          x = %lookup( '' : tokens ) ;
018300180417          if x = 4;
018400180417             Trst = #zFill( 3 : %Trim( Tokens(1) ));
018500180417             Sub  = #zFill( 3 : %Trim( Tokens(2) ));
018600180417             Acct = #zFill( 4 : %Trim( Tokens(3) ));
018700180222
018800180417             s1ActNbr = trst + '-' + Sub + '-' + Acct;
018900180222
019000180417          EndIf;
019100180222
019200180222
019300180222       End-Proc;
019400180912
019500180912
019600180613
