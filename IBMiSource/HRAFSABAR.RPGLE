000100220607      *=========================================================================
000200180323     h dftactgrp(*no) option(*noDebugIo) bnddir('GBSBIND')
000300180323      *=========================================================================
000400220613      * HRAFSABAR - HRA/FSA Plan Benefit Amounts
000500180326      *========================================================================
000600180326      * Date         Int  Description
000700220607      * ----------   ---  -----------------------------------------------------
000800220613      * 06/13/2022   jt   Original Creation
000900180326      *========================================================================
001000180628
001100220613     fhrafsabad cf   e             WorkStn Handler('PROFOUNDUI(HANDLER)')
001101200720
001102220613     fhrafsabap uf a e           k disk     rename(hrafsabar:hrafsaFile)
001103220607
001104220607     fplnmst    if   e           k disk    rename(plnmsr:planFile)
001105220607     f                                     extfile('F.PLNMST')
001106220607
001300220607      //========================================================================
001400180323
001500180323     d psds           sds
001600180323     d proc_name         *proc
001700220607     d user                  254    263
001701200720
001702220607     d valid           s              1  0
001703220607     d fdateISO        s               d
001704220607     d tdateISO        s               d
001705220607     d continue        s              1
001706200720
001707220607     d ChkPgmAuth      pr                  extpgm('CHKPGMAUTH')
001708220607     d  pgmname                      10
001709220607     d  continue                      1
001713220607
002005220613     d hrafsabar       pi
002006220607     d  trst                          3  0
002007220607     d  sub#                          3  0
002008220607     d  acct                          4  0
002009220607     d  ssn                           9  0
002010220607     d  plan                          4
002012220613     d  fdate                         8  0
002013220613     d  tdate                         8  0
002014220607     d  option                        1
002015200720
002100180323      //========================================================================
002200180323      // mainline
002300180323      //========================================================================
002400180323
002500180323       exsr init;
002600180323       exsr main;
002700180323       exsr exit;
002800180323
002900180323      //========================================================================
003000180323      // main
003100180323      //========================================================================
003200180323
003300180323       begsr main;
003400180323
003500180323        dow btnExit = '0';
003600180323
003601220607         exsr loadRecord;
003602220607
003700220607          exfmt screen1;
003800180323
003900180323         exsr checkButton;
004000180323
004100180323        enddo;
004200180323
004300180323       endsr;
004400180323
004401220607      //========================================================================
004402220607      // load record
004403220607      //========================================================================
004404220607
004405220607       begsr loadRecord;
004406220607
004407220607        valid = 0;
004408220613        errBnfAmt = '0';
004409220607
004441220613        if option = 'A' or option = 'E';
004442220607         exsr moveRecord;
004444220607        endif;
004458220613
004459220607       endsr;
004460220607
004461220607      //========================================================================
004462220607      // move values to screen;
004463220607      //========================================================================
004464220607
004465220607       begsr moveRecord;
004466220607
004467220607        if option = 'A';
004468220613         addDelete = 'Accept';
004469220607          splan = plan;
004470220613           shrafsaamt = 0;
004471220613           sfromdate = %date(fdate);
004472220613
004473220613          if tdate > 0;
004474220613           stodate = %date(tdate);
004475220613          endif;
004476220613         leavesr;
004477220607        endif;
004478220607
004479220613        if option = 'E';
004480220613         addDelete = 'Change';
004481220613
004482220613         fdateISO = %date(fdate);
004483220613         sfromdate = %date(fdate);
004484220613
004485220613         if tdate > 0;
004486220613          stodate = %date(tdate);
004487220613          tdateISO = %date(tdate);
004488220613          chain (trst:sub#:acct:ssn:plan:fdateISO:tdateISO) hrafsaFile;
004489220613          splan = plan;
004490220613          shrafsaamt = hbnamt;
004495220613         else;
004496220613          chain (trst:sub#:acct:ssn:plan:fdateISO) hrafsaFile;
004497220613          splan = plan;
004498220613          shrafsaamt = hbnamt;
004499220613         endif;
004500220613
004501220613        endif;
004502220613
004508220607       endsr;
004509220607
004510180323      //========================================================================
004600180323      // checkButton
004700180323      //========================================================================
004800180323
004900180323       begsr checkButton;
005000180323
005300180323        if btnExit = '1';
005400180323         leavesr;
005500180323        endif;
005600180323
005700180323        if btnEnter = '1';
005702220607
005703220607         exsr validate;
005704220607
005705220607          if valid = 0;
005706220613
005707220613           if option = 'A';
005800220613            exsr writeRecord;
005801220613             btnExit = '1';
005802220613            leavesr;
005806220613           endif;
005807220613
005814220613           if option = 'E';
005815220613            exsr editRecord;
005816220613             btnExit = '1';
005817220613            leavesr;
005818220613           endif;
005819220613
005820220607          endif;
005821220607
005822200720         btnEnter = '0';
005900180323        endif;
006000180323
006700180323       endsr;
006800180323
006801220607      //========================================================================
006802220613      // validate record
006803220607      //========================================================================
006804220607
006805220607       begsr validate;
006806220607
006807220607        valid = 0;
006808220613        errBnfAmt = '0';
006809220607
006818220613        if shrafsaamt = 0;
006821220613         valid = 1;
006822220613          errBnfAmt = '1';
006823220613         leavesr;
006824220607        endif;
006825220607
006826220607       endsr;
006827220607
006828220613      //========================================================================
006829220613      // cancel record
006830220613      //========================================================================
006831220613
006832220613       begsr cancelRecord;
006833220613
006834220613        fdateISO = %date(fdate);
006835220613
006836220613        if tdate > 0;
006837220613         tdateISO = %date(tdate);
006839220613
006840220613         chain (trst:sub#:acct:ssn:plan:fdateISO:tdateISO) hrafsaFile;
006841220613         if %found;
006842220613          htodate = %date(tdate);
006843220613           update hrafsaFile;
006844220613          leavesr;
006845220613         endif;
006847220613        endif;
006848220613
006849220613        if not %found;
006851220613         chain (trst:sub#:acct:ssn:plan:fdateISO) hrafsaFile;
006852220613         if %found;
006853220613          if tdate > 0;
006854220613           htodate = %date(tdate);
006856220613           update hrafsaFile;
006857220613          endif;
006858220613         endif;
006860220613        endif;
006861220613
006862220613       endsr;
006863220613
006864220613      //========================================================================
006865220613      // edit record
006866220613      //========================================================================
006867220613
006868220613       begsr editRecord;
006869220613
006870220613        fdateISO = %date(fdate);
006871220613
006872220613        if tdate > 0;
006873220613         tdateISO = %date(tdate);
006874220613
006875220613         chain (trst:sub#:acct:ssn:plan:fdateISO:tdateISO) hrafsaFile;
006876220613         if %found;
006877220613          htodate = %date(tdate);
006878220613           hbnamt = shrafsaamt;
006879220613           update hrafsaFile;
006880220613          leavesr;
006881220613         endif;
006882220613
006883220613        endif;
006884220613
006885220613        if tdate = 0;
006886220613         chain (trst:sub#:acct:ssn:plan:fdateISO) hrafsaFile;
006887220613         if %found;
006888220613          hbnamt = shrafsaamt;
006889220613          update hrafsaFile;
006890220613         endif;
006892220613        endif;
006893220613
006894220613       endsr;
006895220613
006918220607
006919180323      //========================================================================
007000220607      // write record
007100180323      //========================================================================
007200180323
007300220607       begsr writeRecord;
007400180323
007401220613        htrst = trst;
007402220613        hsub# = sub#;
007403220613        hacct = acct;
007404220613        hssn = ssn;
007405220613        hplan = plan;
007406220613        hbnamt = shrafsaamt;
007407220613        hfromdate = %date(fdate);
007408220613
007409220613        if tdate > 0;
007410220613         htodate = %date(tdate);
007412220613        endif;
007413220613
007414220613        hdateadded = %date();
007415220613        haddedby = user;
007416220607
007417220613        write hrafsaFile;
007418220607
008100180323       endsr;
008200180323
008300180323      //========================================================================
008400180323      // exit
008500180323      //========================================================================
008600180323
008700180323       begsr exit;
008800180323
008900180323        *inlr = '1';
009000180323        return;
009100180323
009200180323       endsr;
009300220607
009400180323      //========================================================================
009500180323      // init
009600180323      //========================================================================
009700180323
009800180323       begsr init;
009900180323
010000180323        btnEnter = '0';
010100180323        btnExit = '0';
010300180323        pgmname = proc_name;
010301220607
010302220613        fdateISO = %date(fdate);
010303220613
010304220613        if tdate > 0;
010305220613         tdateISO = %date(tdate);
010306220613        endif;
010307220613
010308220613        //ChkPgmAuth(pgmname : continue);
010309220613        //if continue = 'N';
010310220613        // exsr exit;
010311220613        //endif;
010312220607
010605220607        If option = 'A';
010607220613         chain (trst : sub# : plan) planFile;
010608220607         if %found;
010609220613          if plncat = 'PTN' or plncat = 'PPK'
010610220613           or plncat = 'PFM' or plncat = 'PP3'
010611220613            or plncat = 'PP4' or plncat = 'PP5'
010612220613             or plncat = 'PP6' or plncat = 'P2P'
010613220613            or plncat = 'PFP';
010617220607           leavesr;
010618220613          else;
010619220613          //   text1 = 'This is not an HRA/FSA Plan';
010620220613          //  exfmt msgWindow;
010621220613           exsr exit;
010622220613          endif;
010623220607         endif;
010624220607        endif;
010625220607
010627220613        If option = 'D';
010628220613         exsr cancelRecord;
010629220613         exsr exit;
010630220613        endif;
010631220613
010632220607       endsr;
010800180323
010900180323      //========================================================================
