000100171229
000200171229       Ctl-opt option(*noDebugIo)  bnddir('GBSBIND')  DftActGrp(*no)
000300171229          ActGrp(*New);
000400171229
000500160928      *-------------------------------------------------------------------------
000600160928      *
000700171101      *  Description: Dependent Subfile
000800161007      *  Programmer.: Brian Rees
000900171030      *  Date.......: 10/30/2017
001000160928      *
001100171030      * ?This program uses Profound Logic.
001200161007      *
001300171030      *  Description:
001400161007      *
001500170322      *
001600160928      *-------------------------------------------------------------------------
001700190521      * Change Log
001800160928      *
001900190913      * Date         Programmer    Mod      Description
002000160928      *-------------------------------------------------------------------------
002100190521      * 05/20/2019   B.Rees  Added Longer Names.
002200160928      *
002300160928      *
002400160928      *-------------------------------------------------------------------------
002500171229
002600171229
002700171229
002800171229      *-------------------------------------------------------------------------
002900171229      *
003000171229      * Declare Files
003100171229      *
003200171229      *-------------------------------------------------------------------------
003300171229       Dcl-f Inq006d WorkStn
003400171229          Handler('PROFOUNDUI(HANDLER)')
003500171229          SFILE( DepSFL : rrn)
003600171229          SFILE( PlanSFL : rrn2);
003700171229
003800171229
003900171229       Dcl-f Depndc keyed
004000171229          ExtDesc('F.DEPNDC') ExtFile(*extdesc);
004100171229
004200171229
004300171229       Dcl-f Codesl1 Keyed
004400171229          ExtDesc('F.CODESL1') ExtFile(*extdesc) ;
004500171229
004600171229
004700171229       Dcl-f DCOVL1 Keyed
004800171229          ExtDesc('F.DCOVL1') ExtFile(*extdesc) ;
004900171229
005000171229
005100171229       Dcl-f PLNMST Keyed
005200171229          ExtDesc('F.PLNMST') ExtFile(*extdesc) ;
005300171229
005400171229
005500171229       Dcl-f Depend2 keyed;
005600190521       dcl-f CFS100P keyed;
005700171229
005800161005
005900171229      *-------------------------------------------------------------------------
006000171229      *
006100171229      * Global Variables
006200171229      *
006300171229      *-------------------------------------------------------------------------
006400171229
006500171229       dcl-s ReLoad Char(1);
006600171229       dcl-s rrn Zoned(5);
006700171229       dcl-s rrn2 Zoned(5);
006800171229
007000171229       dcl-s cZip  Char(9);
007100171229
007200180404
007300180404      *-------------------------------------------------------------------------
007400180404      *
007500180404      * *Entry Procedure
007600180404      *
007700180404      *-------------------------------------------------------------------------
007800180404       Dcl-pr Main ExtPgm;
007900180404          *N  Zoned(9);
008000180404       End-Pr;
008100180404
008200180404       dcl-pi Main;
008300180404          pMember Zoned(9);
008400180404       End-Pi;
008500180404
008600171229
008700161005      *-------------------------------------------------------------------------
008800171229      *
008900160928      *?Mainline Program
009000171229      *
009100161005      *-------------------------------------------------------------------------
009200160928
009300171102       dou btnClose = *on;
009301190913
009302190913          if btnClose = *on;
009303190913             leave;
009304190913          endif;
009400160928
009500171229          ClearS1();
009600171229          LoadS1();
009700160928
009800171229          DisplyS1();
010400161223
010401190913
010500161223          Select;
010600161223
010700161223
010800161223          other;
010900171229             ReadChanged();
011000161223
011100161223          endsl;
011200161223
011300161223       enddo;
011400160928
011500161223       *inlr = *on;
011600160928
011700160928      *-------------------------------------------------------------------------
011800171229       Dcl-Proc ClearS1;
011900160928
012000161223          //?Clear the Subfile
012100161223          SflClr = *on;
012200171102          Write DepCtl;
012300161223          SflClr = *off;
012400160928
012500161223          rrn = 0;
012600160928
012700171229       End-Proc;
012800160928      *-------------------------------------------------------------------------
012900171229       Dcl-Proc DisplyS1;
013000160928
013100161223          SflDsp = *on  ;
013200171102          exfmt  DepCtl ;
013300161223          SflDsp = *off;
013400160928
013500171229       End-Proc;
013600160928      *-------------------------------------------------------------------------
013700171229       Dcl-Proc LoadS1;
013800160928
013900161005
014000161223          //----------------------------------------------------
014100171229          // Load the Dependents
014200161223          //----------------------------------------------------
014300171102          Setll pMember Depndc;
014400171102          dou %Eof(Depndc);
014500171102             reade  pMember Depndc;
014600161005
014700171102             if %Eof(Depndc);
014800161223                leave;
014900161223             endif;
015000161222
015100171102             chain drelcd Codesl1;
015200171102             s1Birth = *Blanks;
015300171102             s1Age = 0;
015400171102             if dBirth > 0;
015500171102                s1Birth = %Char(%Date(dbirth:*iso):*Usa);
015600171102                s1Age = %Diff(%Date : %Date(dbirth:*iso) : *Years);
015700171102             endif;
015800190521
015900190521             // Search for Longer Name
016000190521             s1Name = dfName;
016100190521             chain ( pMember : dpSeq# ) CFS100P ;
016200190521             if %Found( CFS100P ) ;
016300190521               s1Name = %trim(cfsfst);
016400190521             endif;
016500190521
016600161223             rrn = rrn + 1;
016700171102             write DepSfl;
016800161223
016900161223
017000161223          enddo;
017100161005
017200161005
017300161005
017400161005
017500171229       End-Proc;
017600161223
017700161223
017800161223      *-------------------------------------------------------------------------
017900171229       Dcl-Proc ReadChanged;
018000161223
018100161223          Dou *in95 = *ON;
018200171102             READC DepSfl;
018300161223             *in95 = %EOF;
018400161223
018500161223             If *in95 = *OFF;
018600161223
018700161223
018800171102                If btnView = *on;
018900171229                   $ViewRecord();
019000171102                endIf;
019100161223
019200161223
019300171102                btnView = *off;
019400171102                update DepSfl;
019500161223
019600161223                Reload = 'Y';
019700161223             endIf;
019800161223
019900161223
020000161223          enddo;
020100171229       End-Proc;
020200161223
020300161223      *-------------------------------------------------------------------------
020400171229       Dcl-Proc $ViewRecord;
020500161223
020600161223
020700171102          dou btnBack = *on;
020800171102
020900171229             ClearS2();
021000171229             LoadS2();
021100171102
021200171229             DisplyS2();
021300171102
021400171102          enddo;
021500161223
021600161223
021700171229       End-Proc;
021800161223
021900171102
022000171102      *-------------------------------------------------------------------------
022100171229       Dcl-Proc LoadS2;
022200171102
022201191113          dcl-s #SSN  Char(9);
022202191113
022300171102          chain ( pMember : dpseq# ) Depndc;
023005191113
023006191113          // Dependent SSN Formatted
023007191113          #SSN = %Editc( depss# : 'X' );
023008191113          s2DepSSN = %Subst( #ssn : 1 : 3 ) + '-' +
023009191113          %Subst( #ssn : 4 : 2 ) + '-' +
023010191113          %Subst( #ssn : 6 : 4 );
023011191113
023012191113          // Member SSN Formatted
023013191113          #SSN = %Editc( pMember : 'X' );
023014191113          s2MbrSSN = %Subst( #ssn : 1 : 3 ) + '-' +
023015191113          %Subst( #ssn : 4 : 2 ) + '-' +
023016191113          %Subst( #ssn : 6 : 4 );
023017191113
023018191113          s2DepSeq = %Editc( dpSeq# : 'X' );
023019191113
023020191113
023021191113
023100171102          s2Status = 'CANCELLED';
023200171102          StsColor = 'Red';
023300171102          if dpdltd = 'A';
023400171102             s2Status = 'ACTIVE';
023500171229             StsColor = 'Yellow';
023600171102          endif;
023700171102
023800171102
023900171102          cZip = %Editc( dZip : 'X' );
024000171102
024100171102          s2FulName = %Trim( dfname ) + ' ' + dmi + ' ' + %Trim( dlname ) ;
024200190521
024300190521          ShowLongNm = *off;
024400190521          chain ( pMember : dpSeq# ) CFS100P ;
024500190521          if %Found( CFS100P ) ;
024600190521            s2FulName = %Trim( cfsfst ) + ' ' + cfsmid + ' ' +
024700190521                        %Trim( cfslst ) ;
024800190521            ShowLongNm = *on;
024900190521          endif;
025000190521
025100190521
025200171102          s2csz = %Trim( dCity ) + ' ' + %Trim( dState ) + ' ' +
025300171229             %Subst( cZip : 1 : 5 ) + '-' + %Subst( cZip : 6 : 4 );
025400171102
025500171102
025600171102          s2email = *Blanks;
025700171102          chain ( pMember : dpseq# ) Depend2;
025800171102          if %Found( Depend2 );
025900171102             s2Email = d2Email;
026000171102          endif;
026100171102
026200171102          s2MedADate = *Blanks;
026300171102          if dMedAd > 0;
026400171102             s2MedADate = %Char(%Date(dMedAd:*iso):*Usa);
026500171102          endif;
026600171102
026700171102
026800171102          s2MedBDate = *Blanks;
026900171102          if dMedBd > 0;
027000171102             s2MedBDate = %Char(%Date(dMedBd:*iso):*Usa);
027100171102          endif;
027200171102
027300171102
027400171102          //-----------------------------------------------------
027500171229          // Load Subfile
027600171102          //-----------------------------------------------------
027700171102          setll ( pMember : dpseq# ) dCovl1;
027800171102          dou %Eof(dCovl1);
027900171102             reade (pMember : dpseq#) dCovl1;
028000171102
028100171102             if %Eof(dCovl1);
028200171102                leave;
028300171102             endif;
028400171102
028500171102             chain ( dvTrst : dvSub# : dvPlan ) PlnMst;
028600171102
028700171102             s2Enroll = *Blanks;
028800171102             s2Cancel = *Blanks;
028900171102
029000171102             if denrdt > 0;
029100171102                s2Enroll = %Char(%Date(denrdt:*iso):*Usa);
029200171102             endif;
029300171102
029400171102
029500171102             if ccandt > 0;
029600171102                s2Cancel = %Char(%Date(ccandt:*iso):*Usa);
029700171102             endif;
029800171102
029900171102             rrn2 = rrn2 + 1;
030000171102             write PlanSfl;
030100171102
030200171102
030300171102
030400171102          enddo;
030500171102
030600171102
030700171102
030800171229       End-Proc;
030900171102
031000161223
031100171102      *-------------------------------------------------------------------------
031200171229       Dcl-Proc ClearS2;
031300171102
031400171102          //?Clear the Subfile
031500171102          SflClr = *on;
031600171102          Write ViewScreen;
031700171102          SflClr = *off;
031800171102
031900171102          rrn2 = 0;
032000171102
032100171229       End-Proc;
032200171102      *-------------------------------------------------------------------------
032300171229       Dcl-Proc DisplyS2;
032400171102
032500171102          SflDsp = *on  ;
032600171102          exfmt  ViewScreen;
032700171102          SflDsp = *off;
032800171102
032900171229       End-Proc;
