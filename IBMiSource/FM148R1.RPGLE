000100220930      *=========================================================================
000200180326     h dftactgrp(*no) option(*noDebugIo) bnddir('GBSBIND')
000300180326      *=========================================================================
000400220804      * FM148R1 - AACODE File Maintenance
000500201009      *=========================================================================
000600180326      * Date         Int  Description
000700200902      * ----------   ---  ------------------------------------------------------
000800220804      * 08/04/2022   jt   Original Creation
000900191209      *=========================================================================
001000100520
001100220804     ffm148d1   cf   e             WorkStn Handler('PROFOUNDUI(HANDLER)')
001200220804     f                                     SFile(SFL1 : RRN)
001300180320
001400220804     faacode    uf A e           k disk    rename(aacodr:aaFile)
001600180410
003600170829      *=========================================================================
003700170829
003800170907     d psds           sds
003900170907     d proc_name         *proc
004000180404     d user                  254    263
004100170907
004200170829     d rrn             s              5i 0
005607210218     d userProfile     s             10
005608220804     d valid           s              1
005609220804     d valid2          s              1
005610220804     d found@          s              2  0
005611220804     d foundCom        s              2  0
005612220804     d foundNet        s              2  0
005613220804     d foundOrg        s              2  0
005614220804     d len             s              2  0
005615220804     d continue        s              1
005616220804     d e1envir         s             15
005617220804     d e1libl          s             10
005618220804     d e1Lib2          s             10
005619220804     d envColor        s             10
005620220804     d e1Acnm          s             40
005621220804
005622220804     d getEnv          pr                  ExtPgm('GETENVR')
005623220804     d  e1envir                      15
005624220804     d  e1libl                       10
005625220804     d  e1Lib2                       10
005626220804     d  envColor                     10
005627220804     d  e1Acnm                       40
005628220930
005700220930     d showAACode      pr                  ExtPgm('WNAACACCTR')
005701220930     d  sacode                        3
005704220930
007312220804     d ChkPgmAuth      pr                  extpgm('CHKPGMAUTH')
007313220804     d  pgmname                      10
007314220804     d  continue                      1
007400180910
007500170829      //========================================================================
007600180320      // mainline
007700180320      //========================================================================
007800170829
007900170829       exsr init;
008000170829       exsr main;
008100170829       exsr exit;
008200170829
008300170829      //========================================================================
008400170829      // main
008500170829      //========================================================================
008600170829
008700170829       begsr main;
008800170829
008900170829        dow btnEXIT = '0';
009000100520
009100180326         // Clear the subfile...
009200170829         sflclr = '1';
009300170829
009400170829         write sflctl1;
009500170829         sflclr = '0';
009600170829         rrn = 0;
009700100520
009800170829         // Load the subfile...
009900170831         exsr loadSubfile;
010000100520
010100170829         // Display the subfile.
010200170829         sfldsp = '1';
010300170829         exfmt sflctl1;
010400180323
010500170831         exsr checkButton;
010600170829
010700170829         sfldsp = '1';
010800170829
010900220804         // Check for icon click.
011000220804         readc sfl1;
011100220804         if not %eof;
011200170829
011300170829         //Lock record for update, if in change mode.
011602220804          if buttonEdit = '1';
011603220804           exsr editRecord;
011604220804           buttonEdit = '0';
011605220804          endif;
011606220804
011607220804          if buttonCopy = '1';
011608220804           exsr copyRecord;
011609220804           buttonCopy = '0';
011610220804          endif;
011611220804
011612220804          if buttonDsp = '1';
011613220804           exsr displayRecord;
011614220804           buttonDsp = '0';
011615220804          endif;
011616220930
011617220930          if selaacode = '1';
011618220930           exsr showAAAccounts;
011619220930           selaacode = '0';
011620220930          endif;
011621220930
012600220804         endif;
012601220804
012700220804        enddo;
012800170829
012900170829       endsr;
013000170829
013100170831      //========================================================================
013200170831      // load subfile
013300170831      //========================================================================
013400170831
013500170831       begsr loadSubfile;
013600170831
014400220804        setll *loval aaFile;
014402220804        read aaFile;
014500180320
015302201009        dow not %eof;
015303220804         if activeOnly = 'Y';
015304220804          if aastat = 'A';
015305220804           rrn += 1;
015306220804
015307220804           exsr moveFields;
015308220804
015309220804           write sfl1;
015310220804          endif;
015311220804
015312220804         else;
015313220804          rrn += 1;
015314220804
015315220804          exsr moveFields;
015316220804
015317220804          write sfl1;
015318220804
015320220804         endif;
015321220804
015400220804        read aaFile;
015500180320        enddo;
015600170831
015601220929        unlock aacode;
015602220929
015900170831       endsr;
016000170831
016100180322      //========================================================================
016200180322      // move fields
016300180322      //========================================================================
016400180322
016500180322       begsr moveFields;
016600180322
016700220804        sacode = acode;
016701220804        saastat = aastat;
016702220804        sacode2 = acode;
016703220804        salnam = alnam;
016800220804        safnam = afnam;
016900220804        saemla = aemla;
016901220804        saddial = addial;
016902220804        sanote1 = anote1;
016903220804        sanote2 = anote2;
016904220929        saastat = aastat;
016906220804
016907220804        dlttext = '0';
016908220804        inActive = 'Black';
016909220804        saastat2 = 'Active';
016910220804        if saastat = 'D';
016911220804         inActive = 'Red';
016912220804          saastat2 = 'Inactive';
016913220804         dlttext = '1';
016914220804        endif;
018319210308
018320220804       endsr;
019100180322
019200180410      //========================================================================
019300180410      // checkButton
019400180410      //========================================================================
019500180410
019600210308       begsr checkButton;
019700180410
020200180410        if buttonAdd  = '1';
020300220804         exsr addRecord;
020301220804         buttonAdd = '0';
020400180410        endif;
020401200224
020900180410       endsr;
021000180410
021100170830      //========================================================================
021200180410      // add record
021300170830      //========================================================================
021400170830
021500220804       begsr addRecord;
021501220804
021504220804        clear adddtl;
021505220804
021506220804        btnCancel = '0';
021507220804        btnAccept = '0';
021508220804
021509220929        saastat = 'A';
021510220929
021511220804        dow btnCancel = '0';
021512220804
021513220804         exfmt adddtl;
021514220804
021515220804         if btnAccept = '1';
021517220804          exsr validate;
021518220804          if valid = '0';
021519220804           exsr addRcd;
021520220929           btnCancel = '1';
021521220804          endif;
021522220804         endif;
021523220804
021524220804        enddo;
021525220804
021526220804        btnAccept = '0';
021527220804
021528220804       endsr;
025000170830
030400170906      //========================================================================
030500220804      // add the record
030600170906      //========================================================================
030700170906
030800220804       begsr addRcd;
030801220804
030802220804        acode = sacode;
030804220804        alnam = salnam;
030805220804        afnam = safnam;
030806220804        aemla = saemla;
030807220804        addial = saddial;
030808220804        anote1 = sanote1;
030809220804        anote2 = sanote2;
030810220929        aastat = saastat;
030811220804
030812220804        write aaFile;
030900170906
032200220804       endsr;
032300170830
032301220804      //========================================================================
032302220804      // copy record
032303220804      //========================================================================
032304220804
032305220804       begsr copyRecord;
032306220804
032307220804        chain sacode aaFile;
032308220804
032309220804        clear maintdtl;
032310220804
032311220804        btnCancel = '0';
032312220804        btnAccept = '0';
032313220804        EditCopy = 'Copy AA Record';
032314220804
032315220804        exsr moveFields;
032316220804
032317220804        dow btnCancel = '0';
032318220804
032319220804         exfmt maintdtl;
032320220804
032321220804         if btnAccept = '1';
032322220804          exsr validate;
032323220804          if valid = '0';
032324220804           exsr editRcd;
032325220929           btnCancel = '1';
032326220804          endif;
032327220804         endif;
032328220804
032329220804        enddo;
032330220804
032331220804        btnAccept = '0';
032332220804
032333220804       endsr;
032334220804
032413170829      //========================================================================
032500180410      // edit record
032600180410      //========================================================================
032700180410
032800180410       begsr editRecord;
032900180410
032903220804        chain sacode aaFile;
032904220804
032905220804        clear maintdtl;
032906220804
032907220804        btnCancel = '0';
032908220804        btnAccept = '0';
032909220804        EditCopy = 'Edit AA Record';
032910220804
032911220804        exsr moveFields;
032912220804
032914220804        dow btnCancel = '0';
032915220804
032916220804         exfmt maintdtl;
032917220804
032918220804         if btnAccept = '1';
032920220804          exsr validate;
032921220804          if valid = '0';
032922220804           exsr editRcd;
032923220929           btnCancel = '1';
032924220804          endif;
032925220804         endif;
032926220804
032927220804        enddo;
032928220804
032929220804        btnAccept = '0';
032930220804
035800180410       endsr;
035900180410
036000180410      //========================================================================
036100180410      // valid record
036200180410      //========================================================================
036300180410
036400220804        begsr validate;
036401220804
036402220804         valid = '0';
036403220804         errCode = '0';
036404220804         errCode2 = '0';
036405220804         errLast = '0';
036406220804         errFirst = '0';
036407220804         errEmail = '0';
036408220804         errPhone = '0';
036409220804         errPhone2 = '0';
036410220804
036411220804         if sacode > ' ';
036413220804          if sacode <> sacode2;
036414220804           chain sacode aaFile;
036415220804           if %found;
036416220804            errCode2 = '1';
036417220804             valid = '1';
036418220804            leavesr;
036420220804           endif;
036421220804          endif;
036422220804         endif;
036423220804
036424220804         if sacode = ' ';
036425220804          errCode = '1';
036426220804           valid = '1';
036427220804          leavesr;
036428220804         endif;
036429220804
036430220804         if salnam = ' ';
036431220804          errlast = '1';
036432220804           valid = '1';
036433220804          leavesr;
036434220804         endif;
036500180410
036501220804         if safnam = ' ';
036502220804          errFirst = '1';
036503220804           valid = '1';
036504220804          leavesr;
036505220804         endif;
036506220804
036507220804         if saemla = ' ';
036508220804          errEmail = '1';
036509220804           valid = '1';
036510220804          leavesr;
036511220804         endif;
036512220804
036513220804         if saemla > ' ';
036514220804          exsr validEmail;
036515220804           if valid2 = '1';
036516220804            errEmail = '1';
036517220804            valid = '1';
036519220804           leavesr;
036520220804          endif;
036521220804         endif;
036522220804
036523220804         if saddial = 0;
036524220804          errPhone = '1';
036525220804           valid = '1';
036526220804          leavesr;
036527220804         endif;
036528220804
036529220804         if saddial > 0;
036530220804          len = %len(%trim(%char(saddial)));
036531220804           if len < 10;
036532220804            errPhone2 = '1';
036533220804            valid = '1';
036534220804           leavesr;
036535220804          endif;
036536220804         endif;
036537220804
040000180410        endsr;
040100180410
040102220804      //========================================================================
040103220804      // validate email
040104220804      //========================================================================
040105220804
040106220804        begsr validEmail;
040107220804
040108220804         valid2 = '1';
040109220804         found@ = 0;
040110220804         foundCom = 0;
040111220804         foundNet = 0;
040112220804         foundOrg = 0;
040113220804
040114220804         found@ = %scan('@':saemla);
040115220804         if found@ = 0;
040116220804          valid2 = '1';
040117220804          leavesr;
040118220804         endif;
040119220804
040120220804         valid2 = '1';
040121220804
040122220804         foundCom = %scan('.com':saemla);
040123220804         if foundCom > 0;
040124220804          valid2 = '0';
040125220804          leavesr;
040126220804         endif;
040127220804
040128220804         foundNet = %scan('.net':saemla);
040129220804         if foundNet > 0;
040131220804          valid2 = '0';
040132220804          leavesr;
040133220804         endif;
040134220804
040135220804         foundOrg = %scan('.org':saemla);
040136220804         if foundOrg > 0;
040137220804          valid2 = '0';
040138220804          leavesr;
040139220804         endif;
040140220804
040146220804        endsr;
040147220804
040200180410      //========================================================================
040300200630      // edit record
040400180410      //========================================================================
040500180410
040600220804        begsr editRcd;
040700180410
040701220804         chain sacode aaFile;
040702220804
040703220804         acode = sacode;
040704220804         alnam = salnam;
040705220804         afnam = safnam;
040706220804         aemla = saemla;
040707220804         addial = saddial;
040708220804         anote1 = sanote1;
040709220804         anote2 = sanote2;
040710220929         aastat = saastat;
040711220804
040712220804         update aaFile;
040713220804
042100180410        endsr;
042200180906
042201220804      //========================================================================
042202220804      // display record
042203220804      //========================================================================
042204220804
042205220804        begsr displayRecord;
042206220804
042209220929         chain(n) sacode aaFile;
042210220804         exsr moveFields;
042211220804
042212220804         btnCancel = '0';
042213220804
042214220804         dow btnCancel = '0';
042216220804
042217220804          exfmt dspdtl;
042218220804
042219220804         enddo;
042220220804
042221220804         btnCancel = '0';
042222220804
042223220804        endsr;
042224220930
042225220930      //========================================================================
042226220930      // show aa acounts
042227220930      //========================================================================
042228220930
042229220930       begsr showAAAccounts;
042230220930
042231220930        showAACode(sacode);
042232220930
042233220930       endsr;
042234220930
060800180622      //========================================================================
060900170829      // exit
061000170829      //========================================================================
061100170829
061200170829       begsr exit;
061300170829
061400170829        *inlr = '1';
061500170829        return;
061600100520
061700170829       endsr;
061800170829
061900170829      //========================================================================
062000170829      // init
062100170829      //========================================================================
062200170829
062300170829       begsr init;
062400170829
062600220804        btnExit = '0';
063100180622
063200180622        sfldsp = '0';
063300180622        sflclr = '0';
063400180622
063500170913        pgmname = proc_name;
063901210218
063903210218        userProfile = user;
063908210218
063909220929        ChkPgmAuth(pgmname : continue);
063910220929        if continue = 'N';
063911220929         exsr exit;
063912220929        endif;
064000180710
064001220804        getenv(e1envir : e1libl : e1Lib2 : envColor : e1Acnm);
064002220804
064100170829       endsr;
064200170829
064300170829      //========================================================================
