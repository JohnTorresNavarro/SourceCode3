000100160413      *=============================================================================================
000200160413     H option(*noDebugIo)
000300150327      *=============================================================================================
000400160413      * EVG800R - Evergreen Exception records
000500150327      *=============================================================================================
000600151113      * Written by:    J. Torres (cloned from AET522R by SSK)
000700160413      * Date Written:  04/13/16
000800160413      * Description:   Do not send any records to Evergreen that are in this file.
000900160413      *                This file gets cleared daily, after the Evergreen job runs.
001000150327      *
001100150327      *  (c)Copyright 2013 by GBS Inc.
001200150327      *  This document contains restricted materials of GBS, Inc.
001300150327
001400150327      *                R E V I S I O N    H I S T O R Y
001500150327      *  Date
001600150327      *  Revised   Initials    Revision
001700150327      *  --------  --------    ---------------------------------------------------------------------
001800150327      *
001900150327      *=============================================================================================
002000160412     FEVG800D   CF   E             WORKSTN INFDS(WSDS) SFILE(S01SFL:RR1)
002100150327
002200160413     FMEMBER    IF   E           K DISK    extfile('F.MEMBER')
002300160413
002400160413     FEXCPTSSN  UF a E           K DISK
002500150327
002600150327      *=============================================================================================
002700160413
002800120813     D HLD@NAME        S             40A
002900120813     D @EMSG           S                   LIKE(EMSG)
003000120813     D ADD_MODE        S               N   INZ(*OFF)
003100120813     D VALID_REC       S               N   INZ(*OFF)
003200120813     D YES             S               N   INZ(*ON)
003300120813     D NO              S               N   INZ(*OFF)
003400150327
003500120813     D WSDS            DS
003600120813     D  FKEY                 369    369A
003700150327
003800120813     D  F1             C                   CONST(X'31')
003900120813     D  F2             C                   CONST(X'32')
004000120813     D  F3             C                   CONST(X'33')
004100120813     D  F4             C                   CONST(X'34')
004200120813     D  F5             C                   CONST(X'35')
004300120813     D  F6             C                   CONST(X'36')
004400120813     D  F7             C                   CONST(X'37')
004500120813     D  F8             C                   CONST(X'38')
004600120813     D  F9             C                   CONST(X'39')
004700120813     D  F10            C                   CONST(X'3A')
004800120813     D  F11            C                   CONST(X'3B')
004900120813     D  F12            C                   CONST(X'3C')
005000120813     D  F13            C                   CONST(X'B1')
005100120813     D  F14            C                   CONST(X'B2')
005200120813     D  F15            C                   CONST(X'B3')
005300120813     D  F16            C                   CONST(X'B4')
005400120813     D  F17            C                   CONST(X'B5')
005500120813     D  F18            C                   CONST(X'B6')
005600120813     D  F19            C                   CONST(X'B7')
005700120813     D  F20            C                   CONST(X'B8')
005800120813     D  F21            C                   CONST(X'B9')
005900120813     D  F22            C                   CONST(X'BA')
006000120813     D  F23            C                   CONST(X'BB')
006100120813     D  F24            C                   CONST(X'BC')
006200150327
006300120813     D                UDS
006400120813     D  XONAME               201    240
006500150327
006600160413     D KF@SSN          S                   LIKE(MBSSNO)
006700150327
006800120813     D @PROC           S             10A
006900150327
007000150327      *=============================================================================================
007100150327      * Mainline
007200150327      *=============================================================================================
007300150327
007400150327      * Main loop...
007500150327     c                   DOU       @PROC = 'EXIT APP  '
007600150327
007700150327     c     @PROC         CASEQ     'PREP SFL  '  $PREPSFL
007800150327     c     @PROC         CASEQ     'BUILD SFL '  $BLDSFL
007900150327     c     @PROC         CASEQ     'SFL CONTRL'  $SFLCTL
008000150327     c     @PROC         CASEQ     'ADD ACCT  '  $ADDACCT
008100150327     c     @PROC         CASEQ     'CHECK SELC'  $CHKSELC
008200150327     c                   ENDCS
008300150327
008400150327     c                   ENDDO
008500150327
008600150327     c                   exsr      exit
008700150327
008800150327      *=============================================================================================
008900150327      * $PREPSFL - Get subfile ready
009000150327      *=============================================================================================
009100150327
009200150327     c     $PREPSFL      BEGSR
009300150327
009400150327     c                   z-add     *ZEROS        RR1               4 0
009500150327     c                   z-add     *ZEROS        #CNTREC           4 0
009600150327
009700150327     c                   EVAL      *IN39 = *OFF
009800150327     c                   EVAL      *IN40 = *OFF
009900150327
010000150327     c                   EVAL      @PROC = 'BUILD SFL '
010100150327
010200150327     c                   ENDSR
010300150327
010400150327      *=============================================================================================
010500150327      * $CLRSFL - Initialize subfile
010600150327      *=============================================================================================
010700150327
010800150327     c     $CLRSFL       BEGSR
010900150327
011000150327     c                   MOVEA     '011'         *IN(25)
011100150327     c                   WRITE     S01CTL
011200150327     c                   MOVEA     '010'         *IN(25)
011300150327     c                   Z-ADD     *ZERO         RR1
011400150327
011500150327     c                   ENDSR
011600150327
011700150327      *=============================================================================================
011800150327      * $BLDSFL - Build subfile
011900150327      *=============================================================================================
012000150327
012100150327     c     $BLDSFL       BEGSR
012200150327
012300150327     c                   MOVE      *ZEROS        #CNTREC
012400150327     c                   MOVE      '0'           @1STLOOP          1
012500150327     c                   MOVE      '0'           @SFLOOP           1
012600150327     c                   MOVE      '0'           *IN20
012700150327
012800150327      * Position subfile?
012900150327     c                   EXSR      $CLRSFL
013000150327     c                   EVAL      CONAME = HLD@NAME
013100150327
013200160413      * Load records...
013300160413     c     KF@SSN        SETLL     EXCPTSR
013400160413
013500160413       if fkey = f5;
013600160413        setll *loval excptsr;
013700160413       endif;
013800160413
013900160413     c                   DOU       %EOF(EXCPTSSN) OR @SFLOOP = '1'
014000160413     c                   READ      EXCPTSR
014100150327
014200160413     c                   IF        NOT %EOF(EXCPTSSN)
014300150327     c                   EXSR      $LOADSFL
014400150327     c                   ENDIF
014500150327
014600150327     c                   ENDDO
014700150327
014800150327     c                   EVAL      @PROC = 'SFL CONTRL'
014900150327
015000150327     c                   ENDSR
015100150327
015200150327      *=============================================================================================
015300150327      * $LOADSFL - Load subfile
015400150327      *=============================================================================================
015500150327
015600150327     c     $LOADSFL      BEGSR
015700150327
015800150327     c                   MOVE      *ON           *IN25
015900150327     c                   MOVE      *BLANKS       SEL
016000150327
016100160413     c                   EVAL      SFSSN# = EXSSNO
016200160413
016300160413       chain exssno member;
016400160413        if mmi > ' ';
016500160413        sfmname = %trim(mlname) + %trim(',') + %trim(mfname) + ' ' + %trim(mmi);
016600160413        else;
016700160413        sfmname = %trim(mlname) + %trim(',') + %trim(mfname);
016800160413        endif;
016900160413
017000150327
017100160413     c                   EVAL      KF@SSN  = EXSSNO
017200150327
017300150327     c                   ADD       1             RR1
017400150327
017500150327     c                   IF        @1STLOOP = '0'
017600150327     c                   Z-ADD     RR1           SFLPOS
017700150327     c                   MOVE      '1'           @1STLOOP
017800150327     c                   ENDIF
017900150327
018000150327     c                   WRITE     S01SFL
018100150327
018200150327     c                   ADD       1             #CNTREC
018300150327     c                   IF        #CNTREC = 300
018400150327     c                   MOVE      '1'           @SFLOOP
018500150327     c                   ENDIF
018600150327
018700150327     c                   ENDSR
018800150327
018900150327      *=============================================================================================
019000150327      * $SFLCTL - Subfile control
019100150327      *=============================================================================================
019200150327
019300150327     c     $SFLCTL       BEGSR
019400150327
019500150327     c                   EVAL      EMSG = @EMSG
019600150327
019700150327     c                   WRITE     S01REC
019800150327     c                   EXFMT     S01CTL
019900150327
020000150327     c                   MOVE      *BLANKS       EMSG
020100150327     c                   MOVE      *BLANKS       @EMSG
020200150327
020300160413     c                   IF        FKEY = F5
020400160413     c                   exsr      $prepsfl
020500160413     c****               EVAL      @PROC = 'BUILD SFL '
020600160413     c                   LEAVESR
020700160413     c                   ENDIF
020800160413
020900150327     c                   IF        FKEY = F3
021000150327     c                   EVAL      @PROC = 'EXIT APP  '
021100150327     c                   LEAVESR
021200150327     c                   ENDIF
021300150327
021400150327     c                   IF        FKEY = F6
021500150327     c                   SETOFF                                       3940
021600150327     c                   CLEAR                   S02R
021700150327     c                   EVAL      CONAME = HLD@NAME
021800150327     c                   EVAL      @PROC = 'ADD ACCT  '
021900150327     c                   LEAVESR
022000150327     c                   ENDIF
022100150327
022200150327     c                   EVAL      @PROC = 'CHECK SELC'
022300150327
022400150327     c                   ENDSR
022500150327
022600150327      *=============================================================================================
022700150327      * $ADDACCT - Add record
022800150327      *=============================================================================================
022900150327
023000150327     c     $ADDACCT      BEGSR
023100150327
023200150327     c                   EXSR      $SCREEN2
023300150327
023400150327     c                   IF        FKEY = F12
023500150327     c                   CLEAR                   S02R
023600150327     c                   EVAL      CONAME = HLD@NAME
023700150327     c                   EVAL      @PROC = 'SFL CONTRL'
023800150327     c                   LEAVESR
023900150327     c                   ENDIF
024000150327
024100150327     c                   EVAL      ADD_MODE = YES
024200150327
024300150327      * Validate command key hit...
024400150327     c                   EXSR      $VALIDKEY
024500150327
024600150327      * Error?
024700150327     c                   IF        VALID_REC = NO
024800150327     c                   LEAVESR
024900150327     c                   ENDIF
025000150327
025100150327      * Validate record...
025200150327     c                   EXSR      $VALIDACC
025300150327
025400150327      * Error?
025500150327     c                   IF        VALID_REC = NO
025600150327     c                   LEAVESR
025700150327     c                   ENDIF
025800150327
025900150327     c                   SETON                                        3940
026000150327
026100150327     c                   DOU       FKEY = F12 OR FKEY = F10
026200150327
026300150327     c                   EXSR      $SCREEN2
026400150327
026500150327      * Cancel...
026600150327     c                   IF        FKEY = F12
026700150327     c                   SETOFF                                       3940
026800150327     c                   LEAVESR
026900150327     c                   ENDIF
027000150327
027100150327      * Add record...
027200150327     c                   IF        FKEY = F10
027300150327     c                   EXSR      $PREPACC
027400160413     c                   EVAL      EXSSNO = SCCID3
027500160413     c                   WRITE     EXCPTSR
027600150327     c                   LEAVE
027700150327     c                   ENDIF
027800150327
027900150327     c                   ENDDO
028000150327
028100150327     c                   EVAL      @PROC = 'BUILD SFL '
028200150327
028300150327     c                   ENDSR
028400150327
028500150327      *=============================================================================================
028600150327      * $SCREEN2 - Add screen
028700150327      *=============================================================================================
028800150327
028900150327     c     $SCREEN2      BEGSR
029000150327
029100150327     c                   EVAL      EMSG = @EMSG
029200150327     c                   EXFMT     S02R
029300150327     c                   CLEAR                   @EMSG
029400150327     c                   EVAL      EMSG = *BLANKS
029500150327
029600150327     c                   ENDSR
029700150327
029800150327      *=============================================================================================
029900150327      * $VALIDKEY - Validity check
030000150327      *=============================================================================================
030100150327
030200150327     c     $VALIDKEY     BEGSR
030300150327
030400150327     c                   EVAL      VALID_REC = NO
030500150327
030600160413     c     SCCID3        CHAIN     MEMBER
030700160413     c                   IF        NOT %FOUND
030800160413     c                   EVAL      @EMSG = 'INVALID SSN'
030900160413     c                   LEAVESR
031000160413     c                   ENDIF
031100150327
031200160413     c                   IF        ADD_MODE = YES
031300160413     c     SCCID3        CHAIN     excptssn
031400160413     c                   IF        %FOUND
031500160413     c                   EVAL      @EMSG = 'SSN ALREADY EXISTS'
031600160413     c                   LEAVESR
031700160413     c                   ENDIF
031800160413     c                   ENDIF
031900160413
032000150327     c                   EVAL      VALID_REC = YES
032100150327
032200150327     c                   ENDSR
032300150327
032400150327      *=============================================================================================
032500150327      * $VALIDACCC - Validity check
032600150327      *=============================================================================================
032700150327
032800150327     c     $VALIDACC     BEGSR
032900150327
033000150327     c                   EVAL      VALID_REC = NO
033100150327
033200160413     c                   IF        SCCID3 = 0
033300160413     c                   EVAL      @EMSG = 'SSN# CANNOT BE EMPTY'
033400150327     c                   LEAVESR
033500150327     c                   ENDIF
033600150327
033700150327     c                   EVAL      VALID_REC = YES
033800150327
033900150327     c                   ENDSR
034000150327
034100150327      *=============================================================================================
034200150327      * $PREPACC - Clear file before writing
034300150327      *=============================================================================================
034400150327
034500150327     c     $PREPACC      BEGSR
034600150327
034700160413     c                   CLEAR                   EXCPTSR
034800150327
034900150327     c                   ENDSR
035000150327
035100150327      *=============================================================================================
035200150327      * $CHKSELC - Check subfile record(s) selected
035300150327      *=============================================================================================
035400150327
035500150327     c     $CHKSELC      BEGSR
035600150327
035700160412     c                   DOU       %EOF(EVG800D)
035800150327     c                   READC     S01SFL
035900160412     c                   IF        NOT %EOF(EVG800D)
036000150327
036100160413     c                   EVAL      KF@SSN  = SFSSN#
036200150327
036300160413     c     KF@SSN        CHAIN     EXCPTSR
036400150327
036500150327     c                   SELECT
036600150327
036700150327     c                   WHEN      SEL = 'I'
036800150327     c                   EXSR      $FMTSCR2
036900150327     c                   EXSR      $INQ2
037000150327
037100150327     c                   WHEN      SEL = 'C'
037200150327     c                   EXSR      $FMTSCR2
037300150327     c                   EXSR      $CHG2
037400150415
037500160413     c                   WHEN      SEL = 'D'
037600160413     c                   EXSR      $FMTSCR2
037700160413     c                   EXSR      $DEL2
037800160413
037900150327     c                   ENDSL
038000150327
038100150327     c                   IF        @EMSG <> *BLANKS
038200150327     c                   LEAVESR
038300150327     c                   ENDIF
038400150327
038500150327     c                   MOVE      *BLANKS       SEL
038600150327     c                   UPDATE    S01SFL
038700150327
038800150327     c                   ENDIF
038900150327     c                   ENDDO
039000150327
039100150327     c****               EVAL      @PROC = 'PREP SFL  '
039200150327     c                   EVAL      @PROC = 'SFL CONTRL'
039300150327
039400150327     c                   ENDSR
039500150327
039600150327      *=============================================================================================
039700150327      * #CALLPLNS - Call plans subfile program
039800150327      *=============================================================================================
039900150327
040000150327     c     $CALLPLNS     BEGSR
040100150327
040200150327
040300150327     c                   ENDSR
040400150327
040500150327      *=============================================================================================
040600150327      * $FMTSCR2 - Inquity mode screen
040700150327      *=============================================================================================
040800150327
040900150327     c     $FMTSCR2      BEGSR
041000150327
041100150327     c                   SETOFF                                       3940
041200150327     c                   CLEAR                   S02R
041300150327     c                   EVAL      CONAME = HLD@NAME
041400150327
041500150327     c                   EXSR      $CHAINS
041600150327
041700150327     c                   ENDSR
041800150327
041900150327      *=============================================================================================
042000150327      * $CHAINS - Get Trust/Sub/Account records
042100150327      *=============================================================================================
042200150327
042300160413       begsr $chains;
042400150327
042500160413       chain kf@ssn member;
042600160413       if %found;
042700160413        sccid3 = mbssno;
042800160413
042900160413        if mmi > ' ';
043000160413        scmname = %trim(mlname) + %trim(',') + %trim(mfname) + ' ' + %trim(mmi);
043100160413        else;
043200160413        scmname = %trim(mlname) + %trim(',') + %trim(mfname);
043300160413        endif;
043400160413
043500160413       endif;
043600160413
043700160413       endsr;
043800150327
043900150327      *=============================================================================================
044000150327      * $INQ2 - Inquiry screen
044100150327      *=============================================================================================
044200150327
044300150327     c     $INQ2         BEGSR
044400150327
044500150327     c                   EVAL      EMSG = 'INQUIRY ONLY'
044600150327     c                   EVAL      *IN40 = *ON
044700150327     c                   DOU       FKEY = F12
044800150327     c                   EXFMT     S02R
044900150327     c                   ENDDO
045000150327
045100150327     c                   ENDSR
045200150327
045300150327      *=============================================================================================
045400150327      * $CHG2 - Change record
045500150327      *=============================================================================================
045600150327
045700150327     c     $CHG2         BEGSR
045800150327
045900150327     c                   EVAL      @EMSG = 'BE CAREFUL'
046000150327
046100150327     c                   DOU       FKEY = F12
046200150327
046300150327     c                   EXSR      $SCREEN2
046400150327
046500150327     c                   IF        FKEY = F12
046600160413     c                   UNLOCK(E) EXCPTSSN
046700150327     c                   SETOFF                                       3940
046800150327     c                   LEAVESR
046900150327     c                   ENDIF
047000150327
047100160413     c                   EVAL      KF@SSN  = SCCID3
047200150327     c
047300150327     c                   EVAL      ADD_MODE = NO
047400150327     c                   EXSR      $VALIDKEY
047500150327     c                   IF        VALID_REC = NO
047600150327     c                   ITER
047700150327     c                   ENDIF
047800150327
047900150327     c                   EXSR      $VALIDACC
048000150327     c                   IF        VALID_REC = NO
048100150327     c                   ITER
048200150327     c                   ENDIF
048300150327
048400150327     c                   SETON                                        3940
048500150327     c                   DOU       FKEY = F12 OR FKEY = F10
048600150327     c                   EXSR      $SCREEN2
048700150327
048800150327     c                   IF        FKEY = F12
048900150327     c                   SETOFF                                       3940
049000150327     c                   LEAVESR
049100150327     c                   ENDIF
049200150327
049300150327     c                   IF        FKEY = F10
049400160413     c                   EVAL      EXSSNO = SCCID3
049500160413     c****               EVAL      EXNAME = SCMNAME
049600160413     c                   UPDATE    EXCPTSR
049700150327     c                   LEAVESR
049800150327     c                   ENDIF
049900150327
050000150327     c                   ENDDO
050100150327
050200150327     c                   ENDDO
050300150327
050400150327     c                   ENDSR
050500150327
050600160413      *=============================================================================================
050700160413      * $DEL2 - Change record
050800160413      *=============================================================================================
050900160413
051000160413     c     $DEL2         BEGSR
051100160413
051200160413     c                   DOU       FKEY = F12
051300160413
051400160413     c                   EXSR      $SCREEN2
051500160413
051600160413     c                   IF        FKEY = F12
051700160413     c                   UNLOCK(E) EXCPTSSN
051800160413     c                   SETOFF                                       3940
051900160413     c                   LEAVESR
052000160413     c                   ENDIF
052100160413
052200160413     c                   EVAL      KF@SSN  = SCCID3
052300160413     c
052400160413     c****               EVAL      ADD_MODE = NO
052500160413     c****               EXSR      $VALIDKEY
052600160413     c****               IF        VALID_REC = NO
052700160413     c****               ITER
052800160413     c****               ENDIF
052900160413
053000160413     c****               EXSR      $VALIDACC
053100160413     c****               IF        VALID_REC = NO
053200160413     c****               ITER
053300160413     c****               ENDIF
053400160413
053500160413     c                   SETON                                        3940
053600160413     c                   DOU       FKEY = F12 OR FKEY = F10
053700160413     c                   EXSR      $SCREEN2
053800160413
053900160413     c                   IF        FKEY = F12
054000160413     c                   SETOFF                                       3940
054100160413     c                   LEAVESR
054200160413     c                   ENDIF
054300160413
054400160413     c                   IF        FKEY = F10
054500160413     c                   DELETE    EXCPTSR
054600160413     c                   LEAVESR
054700160413     c                   ENDIF
054800160413
054900160413     c                   ENDDO
055000160413
055100160413     c                   ENDDO
055200160413
055300160413     c                   ENDSR
055400160413
055500150327      *=============================================================================================
055600150327      * Exit
055700150327      *=============================================================================================
055800150327
055900150327     c     Exit          begsr
056000150327
056100150327     c                   eval      *inlr = yes
056200150327     c                   return
056300150327
056400150327     c                   endsr
056500150327
056600150327      *=============================================================================================
056700150327      * Initializ subroutine
056800150327      *=============================================================================================
056900150327
057000150327     c     *inzsr        begsr
057100150327
057200150327     c                   EVAL      @PROC = 'PREP SFL  '
057300150327     c                   EVAL      HLD@NAME = XONAME
057400150327
057500150327     c                   endsr
057600150327
057700150327      *=============================================================================================
