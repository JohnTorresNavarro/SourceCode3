000001211216
000100211216       Ctl-opt option(*noDebugIo)   DftActGrp(*no)  bnddir('GBSBIND') ;
000200190725
000300190725      *-------------------------------------------------------------------------
000400190725      *
000500211216      *  Description: View the CareFirst Outbound Files
000600190725      *  Programmer.: Brian Rees
000700190725      *  Date.......: 07/25/2019
000800190725      *
000900190725      *-------------------------------------------------------------------------
001000190725
001100190725      *-------------------------------------------------------------------------
001200190725      *
001300190725      * Declare Files
001400190725      *
001500190725      *-------------------------------------------------------------------------
001600211216       Dcl-f Gbs0079d WorkStn
001700190725         Handler('PROFOUNDUI(HANDLER)')
001800211216         SFILE(LstSFL:rrn);
002000190725
002100190725
002200190725      *-------------------------------------------------------------------------
002300190725      *
002400190725      * Global Variables
002500190725      *
002600190725      *-------------------------------------------------------------------------
002700190725
002800190725       dcl-ds pgmd
002900190725         ExtName('IOPGMD') PSDS;
003000190725         @pgmq *proc;
003100190725       end-ds;
003200190725
003300190725
003400190725       dcl-s reLoad Char(1) inz('Y');
003500190725       dcl-s rrn Zoned(5);
003600190725       dcl-c q '''';
003900190725
004000190725
004100190725
004200190725      *--------------------------------------------
004300190725      *
004400190725      * Procedures
004500190725      *
004600190725      *--------------------------------------------
004700190725       /include *LIBL/QMODSRC,#COMMANDPR         // Command
004900190725
005000190725
005001211216       dcl-pr Connect ExtPgm('GBS0079C1') ;
005002211216         FileName Char(150);
005003211216       end-pr;
005004211216       dcl-s FileName Char(150);
005005211216
005100211216       dcl-pr Rtv_NextName ExtPgm('VWCARFTPC3') ;
005200211216         FileName Char(150);
005300190725       end-pr;
005500190725
005501211216       dcl-pr Rtv_File ExtPgm('GBS0079C3') ;
005502211216         FileName Char(150);
005503211216       end-pr;
005504211216
005505211216       dcl-pr End_Connect ExtPgm('GBS0079C2') End-Pr;
006300190725
006400190725      *-------------------------------------------------------------------------
006500190725      *
006600190725      * Mainline Program
006700190725      *
006800190725      *-------------------------------------------------------------------------
006900190725
007200190725       Dou btnExit = *on;
007300190725
007400190725         If Reload = 'Y';
007500190725           ClearS1();
007600190725           LoadS1();
007700190725           Reload = 'N';
007800190725         endIf;
007900190725
007901211216         exfmt LstCtl;
008100190725
008200190725
008300190725         //?Process Selections
008400190725         Select;
008500190725
008600190725         When btnSearch = *on;
008700190725           Reload = 'Y';
008800190725
008900190725
009000190725         When btnReset = *on;
009100190725           Reload = 'Y';
009200190725           s1Search = *blanks;
009300190725
009400190725         other;
009500190725           ReadChangedS1();
009600190725
009700190725         EndSl;
009800190725
009900190725
010000190725       enddo;
010100190725
010200190725       *inlr = *on;
010300190725
010400190725
010500190725
010600190725       // ----------------------------------------------------------------
010700190725       dcl-proc CLEARS1;
010800190725
010900190725         //-------------------------
011000190725         //
011100190725         // Clear the Subfile
011200190725         //
011300190725         //-------------------------
011400190725
011500190725         SflClr = *on;
011600190725         Write LstCtl;
011700190725         SflClr = *off;
011800211216         rrn = 0;
011900190725
011901211216         FileName = '';
012000211216         Connect( FileName );
012001211216
012701211216
012800190725       End-Proc;
012900190725       // ----------------------------------------------------------------
013000190725       Dcl-Proc LoadS1;
013100190725
013200211216         Dou FileName = '*END';
013300190725
013400211216           Rtv_NextName(FileName);
013500190725
013600211216           if FileName = '*END';
013700190725             leave;
013800190725           endif;
013900190725
014000211216           s1FileName = FileName;
014100190725
014200190725
014300190725           if s1Search = *blanks;
014400190725             rrn = rrn + 1;
014500190725             write LstSfl;
014600190725
014700190725           else;   //?Search Field
014800211216             if %scan( %Trim(%upper(s1Search)) : %upper(s1FileName) ) > 0;
014900190725               rrn = rrn + 1;
015000190725               write LstSfl;
015100190725             endif;
015200190725           endif;
015300190725
015400190725           If rrn >= 9999;
015500190725             leave;
015600190725           endIf;
015700190725
015800190725
015900190725         enddo;
016000190725
016001211216         // Disconnect the sFTP Connection
016002211216         End_Connect();
016004211216
016100190725       End-Proc;
016200190725
017100190725
017200190725       // ----------------------------------------------------------------
017300190725       Dcl-Proc ReadChangedS1;
017400190725
017500190725         Dou *in95 = *ON;
017600190725           READC LstSfl;
017700190725           *in95 = %EOF;
017800190725
017900190725           If *in95 = *OFF;
018000190725
018100190725
018200211216             if btnDwnload = *on;
018201211216
018202211216              Rtv_File( s1FileName );
018205211216
018600190725             EndIf;
018700190725
018800190725
018900190725
019000211216             btnDwnload = *off;
019100190725             update LstSfl;
019200190725             Reload = 'Y';
019300190725
019400190725           endIf;
019500190725
019600190725         enddo;
019700190725
019800190725       End-Proc;
019900190725
020000190725
020100190725
