000100160513      *===========================================================================
000200160512     H option(*noDebugIo)
000300160513      *===========================================================================
000400180323      * CIGFI010R - Cigna FI - Non Facets Generate extract
000500180313      *================================================================================
000600180313      * Date        Int   Description
000700180313      * ----------  ---   -------------------------------------------------------------
000800180313      * 03/13/2018  jt    Original creation
000900160513      *===========================================================================
001000170619
001100190130     Fmember    if   e           k disk    extfile('F.MEMBER')
001200190130
001300190130     Fdepndc    if   e           k disk    extfile('F.DEPNDC')
001400190130
001500190130     Fmcovc16   if   e           k disk    extfile('F.MCOVC16')
001600190130     F                                     rename(MCOVR:COVC16)
001700180313
001800190130     Fdcov22    if   e           k disk    extfile('F.DCOV22')
001900190130
002000180523     fcaraccp   if   e           k disk    rename(caraccr:setupFile)
002100180523
002200180523     fcarplnm   if   e           k disk    rename(carplnr:planFile)
002300160513
002400190130     Fgrate     if   e           k disk    extfile('F.GRATE')
002500190130
002600190130     fcignatermsif   e             disk    rename(cignaterms:cignaterm)
002700180523
002800190130     fcignamstrmif a e           k disk    rename(cignatr:cignewterm)
002900190130
003000190130     fcignamstrfif a e           k disk    rename(cignatr:cignewter2)
003100190130
003200160512      *=================================================================
003300061017
003400180309     d carrierCode     s              3
003500180309     d carrierCode1    s              3
003600180309     d carrierCode2    s              3
003700160519     d term_dt_limit   s               d
003800180913     d cancelDate      s               d
003900180913     d cancelh         s              8  0
004000160519     d today           s              8  0
004100180313     d hiredatet       s               d
004200180313     d yrsService      s              8  0
004300180313     d catType         s              3
004400180313     d updateRecord    s              1
004500180313     d writeRecord     s              1
004600180411     d pos             s              2  0
004700180605     d pos2            s              2  0
004800180523     d unique          s             10
004900180523     d alreadySent     s              1
005000180523     d ssn             s              9  0
005100180523     d seq#            s              2  0
005200180523     d ctype           s              3
005300180523     d termdt          s              8  0
005400180523     d covtp           s              2
005500150820
005600160511      //==================================================================
005700160511      // mainline
005800160511      //===================================================================
005900150820
006000160511       exsr init;
006100160511       exsr main;
006200160511       exsr exit;
006300160511
006400160511      //===================================================================
006500160511      // main
006600160511      //===================================================================
006700160511
006800160511       begsr main;
006900160511
007000190130       setll 1 cignaterm;
007100190130       read cignaterm;
007200180424
007300190130       dow not %eof;
007400190130
007500190130        exsr createFile;
007600190130
007700190130       read cignaterm;
007800190130       enddo;
007900190130
008000160511       endsr;
008100180309
008200160511      //===================================================================
008300190130      // create file
008400160511      //===================================================================
008500160511
008600190130       begsr createfile;
008700190130
008800190130        if tseq# = 0;
008900190130         dssno = tssno;
009000190130          chain tssno member;
009100190130           if %found;
009200190130            lname = mlname;
009300190130            fname = mfname;
009400190130           endif;
009500190130
009600190130        endif;
009700190130
009800190130        if tseq# <> 0;
009900190130         chain (tssno : tseq#) depndc;
010000190130          if %found;
010100190130           dssno = depss#;
010200190130            lname = dlname;
010300190130            fname = dfname;
010400190130           mmi = dmi;
010500190130          endif;
010600190130
010700190130        endif;
010800190130
010900190130        exsr determineType;
011000190130        exsr getValues;
011100190130
011200190130        if mplanid <> ' ';
011300190130         exsr getGroup;
011400190130          if writeRecord = 'Y';
011500190130           write cignewterm;
011600190130          endif;
011700190130         exsr writeFinal;
011800190130        endif;
011900180523
012000160511       endsr;
012100160511
012200180523      //===================================================================
012300180523      // get values
012400180523      //===================================================================
012500180523
012600180523       begsr getValues;
012700190130
012800190130        mplanid = ' ';
012900190130        mbranchcd = ' ';
013000190130        mboptcode = ' ';
013100190130        writeRecord = 'Y';
013200190130
013300190130        if tseq# = 0;
013400190130         chain (ttrst:tsub#:tacct:tssno:tplan) mcovc16;
013500190130          if %found;
013600190130           //if enrldt = candt;
013700190130            //writeRecord = 'N';
013800190130            //leavesr;
013900190130           //endif;
014000190130          endif;
014100190130        else;
014200190130         chain (mctrst:mcsub#:mcplan:tssno:tseq#) dcovr;
014300190130          if %found;
014400190130           //if denrdt = ccandt;
014500190130            //writeRecord = 'N';
014600190130            //leavesr;
014700190130           //endif;
014800190130          endif;
014900190130        endif;
015000190130
015100180523        covtp = %subst(mcovtp:2:2);
015200190130        chain (unique:ttrst:tsub#:tplan:tacct:state:covtp) planFile;
015300180523        if %found;
015400180524         exsr get_valuesCategory;
015500180524         leavesr;
015600180524        endif;
015700180523
015800180523        covtp = %subst(mcovtp:2:2);
015900190130        chain (unique:ttrst:tsub#:tplan:tacct:'ALL':covtp) planFile;
016000180523        if %found;
016100180524         exsr get_valuesCategory;
016200180524         leavesr;
016300180524        endif;
016400180523
016500190130        chain (unique:ttrst:tsub#:tplan:tacct:state:'ALL') planFile;
016600180525        if %found;
016700180525         exsr get_valuesCategory;
016800180525         leavesr;
016900180525        endif;
017000180525
017100190130        chain (unique:ttrst:tsub#:tplan:tacct:'ALL':'ALL') planFile;
017200180525        if %found;
017300180525         exsr get_valuesCategory;
017400180525         leavesr;
017500180525        endif;
017600180525
017700180523       endsr;
017800180523
017900180524      //===================================================================
018000180524      // get values
018100180524      //===================================================================
018200180524
018300180524       begsr get_valuesCategory;
018400180524
018500190130        mtype = ttype;
018600190130        if ttype = 'MED';
018700190130         mtype = 'HLT';
018800190130        endif;
018900190130
019000190130        mplanid = cpcid4;
019100190130        mbranchcd = cpcid3;
019200190130        mboptcode = cpcid2;
019300180524
019400180524       endsr;
019500160511
019600180313      //===================================================================
019700180313      // Determine Type
019800180313      //===================================================================
019900180313
020000180313       begsr determineType;
020100180313
020200190130        catType = ttype;
020300180313
020400180313       endsr;
020500190130
020600190130      //===================================================================
020700190130      // Get group number
020800190130      //===================================================================
020900190130
021000190130       begsr getGroup;
021100190130
021200190130        acct# = ' ';
021300190130
021400190130        cancelDate = %date(ttermdt) - %days(1);
021500190130        termdt = %dec(cancelDate);
021600190130
021700190130        setll (ttrst : tsub# : tplan) grater;
021800190130        reade (ttrst : tsub# : tplan) grater;
021900190130
022000190130        dow not %eof;
022100190130
022200190130         if enrldt >= frmdat;
022300190130          if enrldt <= todat;
022400190130           acct# = group#;
022500190130           leavesr;
022600190130          else;
022700190130           group# = ' ';
022800190130          endif;
022900190130         endif;
023000190130
023100190130        reade (ttrst : tsub# : tplan) grater;
023200190130        enddo;
023300190130
023400190130    ?  endsr;
023500190130
023600190130      //===================================================================
023700190130      // write final
023800190130      //===================================================================
023900190130
024000190130       begsr writeFinal;
024100190130
024200190130        cancelDate = %date(ttermdt) - %days(1);
024300190130        ttermdt2 = %dec(cancelDate);
024400190130        write cignewter2;
024500190130
024600190130       endsr;
024700190130
024800190130      //===================================================================
024900160511      // exit
025000160511      //===================================================================
025100160511
025200160511       begsr exit;
025300160511
025400160511        *inlr = '1';
025500160511        return;
025600180523
025700160511       endsr;
025800160511
025900160511      //===================================================================
026000160511      // init
026100160511      //===================================================================
026200160520
026300160511       begsr init;
026400160511
026500180523        unique = '0000000251';
026600170710
026700160511       endsr;
026800010412
026900160511       //==============================================================
